import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { PoChartType } from '../enums/po-chart-type.enum';
import * as i0 from "@angular/core";
import * as i1 from "../services/po-chart-maths.service";
import * as i2 from "@angular/common";
import * as i3 from "./po-chart-axis/po-chart-axis.component";
import * as i4 from "./po-chart-line/po-chart-area/po-chart-area.component";
import * as i5 from "./po-chart-bar/po-chart-column/po-chart-column.component";
import * as i6 from "./po-chart-line/po-chart-line.component";
import * as i7 from "./po-chart-bar/po-chart-bar.component";
import * as i8 from "./po-chart-circular/po-chart-pie/po-chart-pie.component";
import * as i9 from "./po-chart-circular/po-chart-donut/po-chart-donut.component";
const _c0 = ["svgELement"];
function PoChartContainerComponent__svg_g_2_Template(rf, ctx) { if (rf & 1) {
    const _r9 = i0.ɵɵgetCurrentView();
    i0.ɵɵnamespaceSVG();
    i0.ɵɵelementStart(0, "g", 9);
    i0.ɵɵlistener("p-categories-coordinates", function PoChartContainerComponent__svg_g_2_Template__svg_g_p_categories_coordinates_0_listener($event) { i0.ɵɵrestoreView(_r9); const ctx_r8 = i0.ɵɵnextContext(); return ctx_r8.getCategoriesCoordinates($event); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-align-by-the-corners", ctx_r1.alignByTheCorners)("p-range", ctx_r1.range)("p-type", ctx_r1.type)("p-series", ctx_r1.series)("p-container-size", ctx_r1.containerSize)("p-options", ctx_r1.axisOptions)("p-categories", ctx_r1.categories);
} }
function PoChartContainerComponent__svg_g_3_Template(rf, ctx) { if (rf & 1) {
    const _r11 = i0.ɵɵgetCurrentView();
    i0.ɵɵnamespaceSVG();
    i0.ɵɵelementStart(0, "g", 10);
    i0.ɵɵlistener("p-bar-hover", function PoChartContainerComponent__svg_g_3_Template__svg_g_p_bar_hover_0_listener($event) { i0.ɵɵrestoreView(_r11); const ctx_r10 = i0.ɵɵnextContext(); return ctx_r10.onSerieHover($event); })("p-bar-click", function PoChartContainerComponent__svg_g_3_Template__svg_g_p_bar_click_0_listener($event) { i0.ɵɵrestoreView(_r11); const ctx_r12 = i0.ɵɵnextContext(); return ctx_r12.onSerieClick($event); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-align-by-the-corners", ctx_r2.alignByTheCorners)("p-svg-space", ctx_r2.svgSpace)("p-categories", ctx_r2.categories)("p-categories-coordinates", ctx_r2.categoriesCoordinates)("p-range", ctx_r2.range)("p-series", ctx_r2.seriesByType["area"])("p-container-size", ctx_r2.containerSize);
} }
function PoChartContainerComponent__svg_g_4_Template(rf, ctx) { if (rf & 1) {
    const _r14 = i0.ɵɵgetCurrentView();
    i0.ɵɵnamespaceSVG();
    i0.ɵɵelementStart(0, "g", 11);
    i0.ɵɵlistener("p-bar-hover", function PoChartContainerComponent__svg_g_4_Template__svg_g_p_bar_hover_0_listener($event) { i0.ɵɵrestoreView(_r14); const ctx_r13 = i0.ɵɵnextContext(); return ctx_r13.onSerieHover($event); })("p-bar-click", function PoChartContainerComponent__svg_g_4_Template__svg_g_p_bar_click_0_listener($event) { i0.ɵɵrestoreView(_r14); const ctx_r15 = i0.ɵɵnextContext(); return ctx_r15.onSerieClick($event); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-categories", ctx_r3.categories)("p-range", ctx_r3.range)("p-series", ctx_r3.seriesByType["column"])("p-container-size", ctx_r3.containerSize);
} }
function PoChartContainerComponent__svg_g_5_Template(rf, ctx) { if (rf & 1) {
    const _r17 = i0.ɵɵgetCurrentView();
    i0.ɵɵnamespaceSVG();
    i0.ɵɵelementStart(0, "g", 12);
    i0.ɵɵlistener("p-point-hover", function PoChartContainerComponent__svg_g_5_Template__svg_g_p_point_hover_0_listener($event) { i0.ɵɵrestoreView(_r17); const ctx_r16 = i0.ɵɵnextContext(); return ctx_r16.onSerieHover($event); })("p-point-click", function PoChartContainerComponent__svg_g_5_Template__svg_g_p_point_click_0_listener($event) { i0.ɵɵrestoreView(_r17); const ctx_r18 = i0.ɵɵnextContext(); return ctx_r18.onSerieClick($event); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r4 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-categories", ctx_r4.categories)("p-range", ctx_r4.range)("p-series", ctx_r4.seriesByType["line"])("p-container-size", ctx_r4.containerSize);
} }
function PoChartContainerComponent__svg_g_6_Template(rf, ctx) { if (rf & 1) {
    const _r20 = i0.ɵɵgetCurrentView();
    i0.ɵɵnamespaceSVG();
    i0.ɵɵelementStart(0, "g", 13);
    i0.ɵɵlistener("p-bar-hover", function PoChartContainerComponent__svg_g_6_Template__svg_g_p_bar_hover_0_listener($event) { i0.ɵɵrestoreView(_r20); const ctx_r19 = i0.ɵɵnextContext(); return ctx_r19.onSerieHover($event); })("p-bar-click", function PoChartContainerComponent__svg_g_6_Template__svg_g_p_bar_click_0_listener($event) { i0.ɵɵrestoreView(_r20); const ctx_r21 = i0.ɵɵnextContext(); return ctx_r21.onSerieClick($event); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r5 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-categories", ctx_r5.categories)("p-range", ctx_r5.range)("p-series", ctx_r5.seriesByType["bar"])("p-container-size", ctx_r5.containerSize);
} }
function PoChartContainerComponent__svg_g_7_Template(rf, ctx) { if (rf & 1) {
    const _r23 = i0.ɵɵgetCurrentView();
    i0.ɵɵnamespaceSVG();
    i0.ɵɵelementStart(0, "g", 14);
    i0.ɵɵlistener("p-circular-hover", function PoChartContainerComponent__svg_g_7_Template__svg_g_p_circular_hover_0_listener($event) { i0.ɵɵrestoreView(_r23); const ctx_r22 = i0.ɵɵnextContext(); return ctx_r22.onSerieHover($event); })("p-circular-click", function PoChartContainerComponent__svg_g_7_Template__svg_g_p_circular_click_0_listener($event) { i0.ɵɵrestoreView(_r23); const ctx_r24 = i0.ɵɵnextContext(); return ctx_r24.onSerieClick($event); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r6 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-series", ctx_r6.seriesByType["pie"])("p-container-size", ctx_r6.containerSize);
} }
function PoChartContainerComponent__svg_g_8_Template(rf, ctx) { if (rf & 1) {
    const _r26 = i0.ɵɵgetCurrentView();
    i0.ɵɵnamespaceSVG();
    i0.ɵɵelementStart(0, "g", 15);
    i0.ɵɵlistener("p-circular-hover", function PoChartContainerComponent__svg_g_8_Template__svg_g_p_circular_hover_0_listener($event) { i0.ɵɵrestoreView(_r26); const ctx_r25 = i0.ɵɵnextContext(); return ctx_r25.onSerieHover($event); })("p-circular-click", function PoChartContainerComponent__svg_g_8_Template__svg_g_p_circular_click_0_listener($event) { i0.ɵɵrestoreView(_r26); const ctx_r27 = i0.ɵɵnextContext(); return ctx_r27.onSerieClick($event); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r7 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-options", ctx_r7.options)("p-series", ctx_r7.seriesByType["donut"])("p-container-size", ctx_r7.containerSize);
} }
export class PoChartContainerComponent {
    constructor(mathsService) {
        this.mathsService = mathsService;
        this.serieClick = new EventEmitter();
        this.serieHover = new EventEmitter();
        this._series = [];
    }
    set options(value) {
        if (value instanceof Object && !(value instanceof Array)) {
            this._options = value;
            this.verifyAxisOptions(this._options);
        }
    }
    get options() {
        return this._options;
    }
    set series(data) {
        this._series = data;
        this.setAlignByTheCorners(this._series);
        this.setSeriesByType(this._series);
        this.setRange(this._series, this.options);
    }
    get series() {
        return this._series;
    }
    get isTypeCircular() {
        return this.type === PoChartType.Pie || this.type === PoChartType.Donut;
    }
    ngOnChanges(changes) {
        if (changes.type || changes.containerSize) {
            this.setViewBox();
            this.setSvgSpace();
        }
    }
    getCategoriesCoordinates(value) {
        this.categoriesCoordinates = value;
    }
    onSerieClick(event) {
        this.serieClick.emit(event);
    }
    onSerieHover(event) {
        this.serieHover.emit(event);
    }
    getRange(series, options = {}) {
        const domain = this.mathsService.calculateMinAndMaxValues(series);
        const minValue = !options.axis?.minRange && domain.minValue > 0
            ? 0
            : options.axis?.minRange < domain.minValue
                ? options.axis.minRange
                : domain.minValue;
        const maxValue = options.axis?.maxRange > domain.maxValue ? options.axis.maxRange : domain.maxValue;
        const updatedDomainValues = { minValue, maxValue };
        return { ...domain, ...updatedDomainValues };
    }
    setSvgSpace() {
        // Representa um ponto 2D dentro do viewport do SVG. Ele é a representação do cursor do mouse para comparação de coordenadas com cada dado de série.
        const svgPoint = this.svgELement.nativeElement.createSVGPoint();
        // Retorna um DOMMatrix representando as matrizes 2D e 3D transformadas a partir das coordenadas do elemento, em relação ao document, para coordenadas relativas ao viewport do SVG.
        // É utilizado nos gráficos do tipo área para que seja possível equiparar as coordenadas do evento com cada dado de série, para assim ativar o ponto de dado equivalente.
        const svgDomMatrix = this.svgELement.nativeElement.getScreenCTM()?.inverse();
        this.svgSpace = { svgPoint, svgDomMatrix };
    }
    setAlignByTheCorners(series) {
        this.alignByTheCorners = series.every(serie => serie.type === PoChartType.Area || serie.type === PoChartType.Bar);
    }
    setRange(series, options = {}) {
        if (!this.isTypeCircular) {
            this.range = this.getRange(series, options);
        }
    }
    setSeriesByType(series) {
        this.seriesByType = {
            [PoChartType.Area]: series.filter(serie => serie.type === PoChartType.Area),
            [PoChartType.Column]: series.filter(serie => serie.type === PoChartType.Column),
            [PoChartType.Bar]: series.filter(serie => serie.type === PoChartType.Bar),
            [PoChartType.Line]: series.filter(serie => serie.type === PoChartType.Line),
            [PoChartType.Donut]: series.filter(serie => serie.type === PoChartType.Donut),
            [PoChartType.Pie]: series.filter(serie => serie.type === PoChartType.Pie)
        };
    }
    setViewBox() {
        const { svgWidth, svgHeight } = this.containerSize;
        const viewBoxWidth = this.isTypeCircular ? svgHeight : svgWidth;
        // Tratamento necessário para que não corte o vetor nas extremidades
        const offsetXY = 1;
        this.viewBox = `${offsetXY} -${offsetXY} ${viewBoxWidth} ${this.containerSize.svgHeight}`;
    }
    verifyAxisOptions(options) {
        if (!this.isTypeCircular && options.hasOwnProperty('axis')) {
            this.range = this.getRange(this.series, this.options);
            this.axisOptions = {
                ...this.axisOptions,
                ...options.axis
            };
        }
    }
}
PoChartContainerComponent.ɵfac = function PoChartContainerComponent_Factory(t) { return new (t || PoChartContainerComponent)(i0.ɵɵdirectiveInject(i1.PoChartMathsService)); };
PoChartContainerComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoChartContainerComponent, selectors: [["po-chart-container"]], viewQuery: function PoChartContainerComponent_Query(rf, ctx) { if (rf & 1) {
        i0.ɵɵviewQuery(_c0, 7);
    } if (rf & 2) {
        let _t;
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.svgELement = _t.first);
    } }, inputs: { categories: ["p-categories", "categories"], type: ["p-type", "type"], containerSize: ["p-container-size", "containerSize"], options: ["p-options", "options"], series: ["p-series", "series"] }, outputs: { serieClick: "p-serie-click", serieHover: "p-serie-hover" }, features: [i0.ɵɵNgOnChangesFeature], decls: 9, vars: 10, consts: [["preserveAspectRatio", "xMidYMin meet", 1, "po-chart-svg-element"], ["svgELement", ""], ["po-chart-axis", "", 3, "p-align-by-the-corners", "p-range", "p-type", "p-series", "p-container-size", "p-options", "p-categories", "p-categories-coordinates", 4, "ngIf"], ["po-chart-area", "", 3, "p-align-by-the-corners", "p-svg-space", "p-categories", "p-categories-coordinates", "p-range", "p-series", "p-container-size", "p-bar-hover", "p-bar-click", 4, "ngIf"], ["po-chart-column", "", 3, "p-categories", "p-range", "p-series", "p-container-size", "p-bar-hover", "p-bar-click", 4, "ngIf"], ["po-chart-line", "", 3, "p-categories", "p-range", "p-series", "p-container-size", "p-point-hover", "p-point-click", 4, "ngIf"], ["po-chart-bar", "", 3, "p-categories", "p-range", "p-series", "p-container-size", "p-bar-hover", "p-bar-click", 4, "ngIf"], ["po-chart-pie", "", 3, "p-series", "p-container-size", "p-circular-hover", "p-circular-click", 4, "ngIf"], ["po-chart-donut", "", 3, "p-options", "p-series", "p-container-size", "p-circular-hover", "p-circular-click", 4, "ngIf"], ["po-chart-axis", "", 3, "p-align-by-the-corners", "p-range", "p-type", "p-series", "p-container-size", "p-options", "p-categories", "p-categories-coordinates"], ["po-chart-area", "", 3, "p-align-by-the-corners", "p-svg-space", "p-categories", "p-categories-coordinates", "p-range", "p-series", "p-container-size", "p-bar-hover", "p-bar-click"], ["po-chart-column", "", 3, "p-categories", "p-range", "p-series", "p-container-size", "p-bar-hover", "p-bar-click"], ["po-chart-line", "", 3, "p-categories", "p-range", "p-series", "p-container-size", "p-point-hover", "p-point-click"], ["po-chart-bar", "", 3, "p-categories", "p-range", "p-series", "p-container-size", "p-bar-hover", "p-bar-click"], ["po-chart-pie", "", 3, "p-series", "p-container-size", "p-circular-hover", "p-circular-click"], ["po-chart-donut", "", 3, "p-options", "p-series", "p-container-size", "p-circular-hover", "p-circular-click"]], template: function PoChartContainerComponent_Template(rf, ctx) { if (rf & 1) {
        i0.ɵɵnamespaceSVG();
        i0.ɵɵelementStart(0, "svg", 0, 1);
        i0.ɵɵtemplate(2, PoChartContainerComponent__svg_g_2_Template, 1, 7, "g", 2);
        i0.ɵɵtemplate(3, PoChartContainerComponent__svg_g_3_Template, 1, 7, "g", 3);
        i0.ɵɵtemplate(4, PoChartContainerComponent__svg_g_4_Template, 1, 4, "g", 4);
        i0.ɵɵtemplate(5, PoChartContainerComponent__svg_g_5_Template, 1, 4, "g", 5);
        i0.ɵɵtemplate(6, PoChartContainerComponent__svg_g_6_Template, 1, 4, "g", 6);
        i0.ɵɵtemplate(7, PoChartContainerComponent__svg_g_7_Template, 1, 2, "g", 7);
        i0.ɵɵtemplate(8, PoChartContainerComponent__svg_g_8_Template, 1, 3, "g", 8);
        i0.ɵɵelementEnd();
    } if (rf & 2) {
        i0.ɵɵattribute("viewBox", ctx.viewBox)("width", ctx.containerSize.svgWidth)("height", ctx.containerSize.svgHeight);
        i0.ɵɵadvance(2);
        i0.ɵɵproperty("ngIf", !ctx.isTypeCircular);
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngIf", (ctx.type === "area" || ctx.type === "line" || ctx.type === "column") && ctx.seriesByType["area"].length);
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngIf", (ctx.type === "area" || ctx.type === "line" || ctx.type === "column") && ctx.seriesByType["column"].length);
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngIf", (ctx.type === "area" || ctx.type === "line" || ctx.type === "column") && ctx.seriesByType["line"].length);
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngIf", ctx.type === "bar");
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngIf", ctx.type === "pie");
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngIf", ctx.type === "donut");
    } }, directives: [i2.NgIf, i3.PoChartAxisComponent, i4.PoChartAreaComponent, i5.PoChartColumnComponent, i6.PoChartLineComponent, i7.PoChartBarComponent, i8.PoChartPieComponent, i9.PoChartDonutComponent], encapsulation: 2 });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoChartContainerComponent, [{
        type: Component,
        args: [{ selector: 'po-chart-container', template: "<svg:svg\n  #svgELement\n  class=\"po-chart-svg-element\"\n  preserveAspectRatio=\"xMidYMin meet\"\n  [attr.viewBox]=\"viewBox\"\n  [attr.width]=\"containerSize.svgWidth\"\n  [attr.height]=\"containerSize.svgHeight\"\n>\n  <!-- axis -->\n  <svg:g\n    *ngIf=\"!isTypeCircular\"\n    po-chart-axis\n    [p-align-by-the-corners]=\"alignByTheCorners\"\n    [p-range]=\"range\"\n    [p-type]=\"type\"\n    [p-series]=\"series\"\n    [p-container-size]=\"containerSize\"\n    [p-options]=\"axisOptions\"\n    [p-categories]=\"categories\"\n    (p-categories-coordinates)=\"getCategoriesCoordinates($event)\"\n  ></svg:g>\n\n  <!-- chart area -->\n  <svg:g\n    *ngIf=\"(type === 'area' || type === 'line' || type === 'column') && seriesByType['area'].length\"\n    po-chart-area\n    [p-align-by-the-corners]=\"alignByTheCorners\"\n    [p-svg-space]=\"svgSpace\"\n    [p-categories]=\"categories\"\n    [p-categories-coordinates]=\"categoriesCoordinates\"\n    [p-range]=\"range\"\n    [p-series]=\"seriesByType['area']\"\n    [p-container-size]=\"containerSize\"\n    (p-bar-hover)=\"onSerieHover($event)\"\n    (p-bar-click)=\"onSerieClick($event)\"\n  ></svg:g>\n\n  <!-- chart column -->\n  <svg:g\n    *ngIf=\"(type === 'area' || type === 'line' || type === 'column') && seriesByType['column'].length\"\n    po-chart-column\n    [p-categories]=\"categories\"\n    [p-range]=\"range\"\n    [p-series]=\"seriesByType['column']\"\n    [p-container-size]=\"containerSize\"\n    (p-bar-hover)=\"onSerieHover($event)\"\n    (p-bar-click)=\"onSerieClick($event)\"\n  ></svg:g>\n\n  <!-- chart line -->\n  <svg:g\n    *ngIf=\"(type === 'area' || type === 'line' || type === 'column') && seriesByType['line'].length\"\n    po-chart-line\n    [p-categories]=\"categories\"\n    [p-range]=\"range\"\n    [p-series]=\"seriesByType['line']\"\n    [p-container-size]=\"containerSize\"\n    (p-point-hover)=\"onSerieHover($event)\"\n    (p-point-click)=\"onSerieClick($event)\"\n  ></svg:g>\n\n  <!-- chart bar -->\n  <svg:g\n    *ngIf=\"type === 'bar'\"\n    po-chart-bar\n    [p-categories]=\"categories\"\n    [p-range]=\"range\"\n    [p-series]=\"seriesByType['bar']\"\n    [p-container-size]=\"containerSize\"\n    (p-bar-hover)=\"onSerieHover($event)\"\n    (p-bar-click)=\"onSerieClick($event)\"\n  ></svg:g>\n\n  <svg:g\n    *ngIf=\"type === 'pie'\"\n    po-chart-pie\n    [p-series]=\"seriesByType['pie']\"\n    [p-container-size]=\"containerSize\"\n    (p-circular-hover)=\"onSerieHover($event)\"\n    (p-circular-click)=\"onSerieClick($event)\"\n  ></svg:g>\n\n  <svg:g\n    *ngIf=\"type === 'donut'\"\n    po-chart-donut\n    [p-options]=\"options\"\n    [p-series]=\"seriesByType['donut']\"\n    [p-container-size]=\"containerSize\"\n    (p-circular-hover)=\"onSerieHover($event)\"\n    (p-circular-click)=\"onSerieClick($event)\"\n  ></svg:g>\n</svg:svg>\n" }]
    }], function () { return [{ type: i1.PoChartMathsService }]; }, { categories: [{
            type: Input,
            args: ['p-categories']
        }], type: [{
            type: Input,
            args: ['p-type']
        }], containerSize: [{
            type: Input,
            args: ['p-container-size']
        }], serieClick: [{
            type: Output,
            args: ['p-serie-click']
        }], serieHover: [{
            type: Output,
            args: ['p-serie-hover']
        }], svgELement: [{
            type: ViewChild,
            args: ['svgELement', { static: true }]
        }], options: [{
            type: Input,
            args: ['p-options']
        }], series: [{
            type: Input,
            args: ['p-series']
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hhcnQtY29udGFpbmVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1jaGFydC9wby1jaGFydC1jb250YWluZXIvcG8tY2hhcnQtY29udGFpbmVyLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1jaGFydC9wby1jaGFydC1jb250YWluZXIvcG8tY2hhcnQtY29udGFpbmVyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQWMsWUFBWSxFQUFFLEtBQUssRUFBYSxNQUFNLEVBQWlCLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV4SCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7Ozs7Ozs7Ozs7Ozs7OztJQ094RCw0QkFXQztJQURDLHFOQUE0Qix1Q0FBZ0MsSUFBQztJQUM5RCxpQkFBUTs7O0lBUlAsaUVBQTRDLHlCQUFBLHVCQUFBLDJCQUFBLDBDQUFBLGlDQUFBLG1DQUFBOzs7OztJQVc5Qyw2QkFZQztJQUZDLDZMQUFlLDRCQUFvQixJQUFDLGdMQUNyQiw0QkFBb0IsSUFEQztJQUVyQyxpQkFBUTs7O0lBVFAsaUVBQTRDLGdDQUFBLG1DQUFBLDBEQUFBLHlCQUFBLHlDQUFBLDBDQUFBOzs7OztJQVk5Qyw2QkFTQztJQUZDLDZMQUFlLDRCQUFvQixJQUFDLGdMQUNyQiw0QkFBb0IsSUFEQztJQUVyQyxpQkFBUTs7O0lBTlAsZ0RBQTJCLHlCQUFBLDJDQUFBLDBDQUFBOzs7OztJQVM3Qiw2QkFTQztJQUZDLGlNQUFpQiw0QkFBb0IsSUFBQyxvTEFDckIsNEJBQW9CLElBREM7SUFFdkMsaUJBQVE7OztJQU5QLGdEQUEyQix5QkFBQSx5Q0FBQSwwQ0FBQTs7Ozs7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O2tCQUFoQyxLQUFLO21CQUFDLGNBQWM7WUFFSixJQUFJO2tCQUFwQixLQUFLO21CQUFDLFFBQVE7WUFFWSxhQUFhO2tCQUF2QyxLQUFLO21CQUFDLGtCQUFrQjtZQUVBLFVBQVU7a0JBQWxDLE1BQU07bUJBQUMsZUFBZTtZQUVFLFVBQVU7a0JBQWxDLE1BQU07bUJBQUMsZUFBZTtZQUVvQixVQUFVO2tCQUFwRCxTQUFTO21CQUFDLFlBQVksRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7WUFhakIsT0FBTztrQkFBOUIsS0FBSzttQkFBQyxXQUFXO1lBWUssTUFBTTtrQkFBNUIsS0FBSzttQkFBQyxVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkNoYW5nZXMsIE91dHB1dCwgU2ltcGxlQ2hhbmdlcywgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFBvQ2hhcnRUeXBlIH0gZnJvbSAnLi4vZW51bXMvcG8tY2hhcnQtdHlwZS5lbnVtJztcbmltcG9ydCB7IFBvQ2hhcnRDb250YWluZXJTaXplIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9wby1jaGFydC1jb250YWluZXItc2l6ZS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9DaGFydE9wdGlvbnMgfSBmcm9tICcuLi9pbnRlcmZhY2VzL3BvLWNoYXJ0LW9wdGlvbnMuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvQ2hhcnRBeGlzT3B0aW9ucyB9IGZyb20gJy4uL2ludGVyZmFjZXMvcG8tY2hhcnQtYXhpcy1vcHRpb25zLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb0NoYXJ0TWF0aHNTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvcG8tY2hhcnQtbWF0aHMuc2VydmljZSc7XG5pbXBvcnQgeyBQb0NoYXJ0TWluTWF4VmFsdWVzIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9wby1jaGFydC1taW4tbWF4LXZhbHVlcy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9DaGFydFNlcmllIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9wby1jaGFydC1zZXJpZS5pbnRlcmZhY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwby1jaGFydC1jb250YWluZXInLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tY2hhcnQtY29udGFpbmVyLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBQb0NoYXJ0Q29udGFpbmVyQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcbiAgQElucHV0KCdwLWNhdGVnb3JpZXMnKSBjYXRlZ29yaWVzOiBBcnJheTxzdHJpbmc+O1xuXG4gIEBJbnB1dCgncC10eXBlJykgdHlwZTogUG9DaGFydFR5cGU7XG5cbiAgQElucHV0KCdwLWNvbnRhaW5lci1zaXplJykgY29udGFpbmVyU2l6ZTogUG9DaGFydENvbnRhaW5lclNpemU7XG5cbiAgQE91dHB1dCgncC1zZXJpZS1jbGljaycpIHNlcmllQ2xpY2sgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBAT3V0cHV0KCdwLXNlcmllLWhvdmVyJykgc2VyaWVIb3ZlciA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIEBWaWV3Q2hpbGQoJ3N2Z0VMZW1lbnQnLCB7IHN0YXRpYzogdHJ1ZSB9KSBzdmdFTGVtZW50OiBFbGVtZW50UmVmO1xuXG4gIGFsaWduQnlUaGVDb3JuZXJzOiBib29sZWFuO1xuICBheGlzT3B0aW9uczogUG9DaGFydEF4aXNPcHRpb25zO1xuICBjYXRlZ29yaWVzQ29vcmRpbmF0ZXM6IEFycmF5PG51bWJlcj47XG4gIHJhbmdlOiBQb0NoYXJ0TWluTWF4VmFsdWVzO1xuICBzZXJpZXNCeVR5cGU7XG4gIHN2Z1NwYWNlO1xuICB2aWV3Qm94OiBzdHJpbmc7XG5cbiAgcHJpdmF0ZSBfb3B0aW9uczogUG9DaGFydE9wdGlvbnM7XG4gIHByaXZhdGUgX3NlcmllczogQXJyYXk8UG9DaGFydFNlcmllPiA9IFtdO1xuXG4gIEBJbnB1dCgncC1vcHRpb25zJykgc2V0IG9wdGlvbnModmFsdWU6IFBvQ2hhcnRPcHRpb25zKSB7XG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgT2JqZWN0ICYmICEodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkpIHtcbiAgICAgIHRoaXMuX29wdGlvbnMgPSB2YWx1ZTtcblxuICAgICAgdGhpcy52ZXJpZnlBeGlzT3B0aW9ucyh0aGlzLl9vcHRpb25zKTtcbiAgICB9XG4gIH1cblxuICBnZXQgb3B0aW9ucygpIHtcbiAgICByZXR1cm4gdGhpcy5fb3B0aW9ucztcbiAgfVxuXG4gIEBJbnB1dCgncC1zZXJpZXMnKSBzZXQgc2VyaWVzKGRhdGE6IEFycmF5PFBvQ2hhcnRTZXJpZT4pIHtcbiAgICB0aGlzLl9zZXJpZXMgPSBkYXRhO1xuICAgIHRoaXMuc2V0QWxpZ25CeVRoZUNvcm5lcnModGhpcy5fc2VyaWVzKTtcbiAgICB0aGlzLnNldFNlcmllc0J5VHlwZSh0aGlzLl9zZXJpZXMpO1xuICAgIHRoaXMuc2V0UmFuZ2UodGhpcy5fc2VyaWVzLCB0aGlzLm9wdGlvbnMpO1xuICB9XG5cbiAgZ2V0IHNlcmllcygpIHtcbiAgICByZXR1cm4gdGhpcy5fc2VyaWVzO1xuICB9XG5cbiAgZ2V0IGlzVHlwZUNpcmN1bGFyKCkge1xuICAgIHJldHVybiB0aGlzLnR5cGUgPT09IFBvQ2hhcnRUeXBlLlBpZSB8fCB0aGlzLnR5cGUgPT09IFBvQ2hhcnRUeXBlLkRvbnV0O1xuICB9XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBtYXRoc1NlcnZpY2U6IFBvQ2hhcnRNYXRoc1NlcnZpY2UpIHt9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmIChjaGFuZ2VzLnR5cGUgfHwgY2hhbmdlcy5jb250YWluZXJTaXplKSB7XG4gICAgICB0aGlzLnNldFZpZXdCb3goKTtcbiAgICAgIHRoaXMuc2V0U3ZnU3BhY2UoKTtcbiAgICB9XG4gIH1cblxuICBnZXRDYXRlZ29yaWVzQ29vcmRpbmF0ZXModmFsdWU6IEFycmF5PG51bWJlcj4pOiB2b2lkIHtcbiAgICB0aGlzLmNhdGVnb3JpZXNDb29yZGluYXRlcyA9IHZhbHVlO1xuICB9XG5cbiAgb25TZXJpZUNsaWNrKGV2ZW50OiBhbnkpIHtcbiAgICB0aGlzLnNlcmllQ2xpY2suZW1pdChldmVudCk7XG4gIH1cblxuICBvblNlcmllSG92ZXIoZXZlbnQ6IGFueSkge1xuICAgIHRoaXMuc2VyaWVIb3Zlci5lbWl0KGV2ZW50KTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0UmFuZ2Uoc2VyaWVzOiBBcnJheTxQb0NoYXJ0U2VyaWU+LCBvcHRpb25zOiBQb0NoYXJ0T3B0aW9ucyA9IHt9KTogUG9DaGFydE1pbk1heFZhbHVlcyB7XG4gICAgY29uc3QgZG9tYWluID0gdGhpcy5tYXRoc1NlcnZpY2UuY2FsY3VsYXRlTWluQW5kTWF4VmFsdWVzKHNlcmllcyk7XG4gICAgY29uc3QgbWluVmFsdWUgPVxuICAgICAgIW9wdGlvbnMuYXhpcz8ubWluUmFuZ2UgJiYgZG9tYWluLm1pblZhbHVlID4gMFxuICAgICAgICA/IDBcbiAgICAgICAgOiBvcHRpb25zLmF4aXM/Lm1pblJhbmdlIDwgZG9tYWluLm1pblZhbHVlXG4gICAgICAgID8gb3B0aW9ucy5heGlzLm1pblJhbmdlXG4gICAgICAgIDogZG9tYWluLm1pblZhbHVlO1xuICAgIGNvbnN0IG1heFZhbHVlID0gb3B0aW9ucy5heGlzPy5tYXhSYW5nZSA+IGRvbWFpbi5tYXhWYWx1ZSA/IG9wdGlvbnMuYXhpcy5tYXhSYW5nZSA6IGRvbWFpbi5tYXhWYWx1ZTtcbiAgICBjb25zdCB1cGRhdGVkRG9tYWluVmFsdWVzID0geyBtaW5WYWx1ZSwgbWF4VmFsdWUgfTtcblxuICAgIHJldHVybiB7IC4uLmRvbWFpbiwgLi4udXBkYXRlZERvbWFpblZhbHVlcyB9O1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRTdmdTcGFjZSgpIHtcbiAgICAvLyBSZXByZXNlbnRhIHVtIHBvbnRvIDJEIGRlbnRybyBkbyB2aWV3cG9ydCBkbyBTVkcuIEVsZSDDqSBhIHJlcHJlc2VudGHDp8OjbyBkbyBjdXJzb3IgZG8gbW91c2UgcGFyYSBjb21wYXJhw6fDo28gZGUgY29vcmRlbmFkYXMgY29tIGNhZGEgZGFkbyBkZSBzw6lyaWUuXG4gICAgY29uc3Qgc3ZnUG9pbnQgPSB0aGlzLnN2Z0VMZW1lbnQubmF0aXZlRWxlbWVudC5jcmVhdGVTVkdQb2ludCgpO1xuICAgIC8vIFJldG9ybmEgdW0gRE9NTWF0cml4IHJlcHJlc2VudGFuZG8gYXMgbWF0cml6ZXMgMkQgZSAzRCB0cmFuc2Zvcm1hZGFzIGEgcGFydGlyIGRhcyBjb29yZGVuYWRhcyBkbyBlbGVtZW50bywgZW0gcmVsYcOnw6NvIGFvIGRvY3VtZW50LCBwYXJhIGNvb3JkZW5hZGFzIHJlbGF0aXZhcyBhbyB2aWV3cG9ydCBkbyBTVkcuXG4gICAgLy8gw4kgdXRpbGl6YWRvIG5vcyBncsOhZmljb3MgZG8gdGlwbyDDoXJlYSBwYXJhIHF1ZSBzZWphIHBvc3PDrXZlbCBlcXVpcGFyYXIgYXMgY29vcmRlbmFkYXMgZG8gZXZlbnRvIGNvbSBjYWRhIGRhZG8gZGUgc8OpcmllLCBwYXJhIGFzc2ltIGF0aXZhciBvIHBvbnRvIGRlIGRhZG8gZXF1aXZhbGVudGUuXG4gICAgY29uc3Qgc3ZnRG9tTWF0cml4ID0gdGhpcy5zdmdFTGVtZW50Lm5hdGl2ZUVsZW1lbnQuZ2V0U2NyZWVuQ1RNKCk/LmludmVyc2UoKTtcblxuICAgIHRoaXMuc3ZnU3BhY2UgPSB7IHN2Z1BvaW50LCBzdmdEb21NYXRyaXggfTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0QWxpZ25CeVRoZUNvcm5lcnMoc2VyaWVzOiBBcnJheTxQb0NoYXJ0U2VyaWU+KTogdm9pZCB7XG4gICAgdGhpcy5hbGlnbkJ5VGhlQ29ybmVycyA9IHNlcmllcy5ldmVyeShzZXJpZSA9PiBzZXJpZS50eXBlID09PSBQb0NoYXJ0VHlwZS5BcmVhIHx8IHNlcmllLnR5cGUgPT09IFBvQ2hhcnRUeXBlLkJhcik7XG4gIH1cblxuICBwcml2YXRlIHNldFJhbmdlKHNlcmllczogQXJyYXk8UG9DaGFydFNlcmllPiwgb3B0aW9uczogUG9DaGFydE9wdGlvbnMgPSB7fSkge1xuICAgIGlmICghdGhpcy5pc1R5cGVDaXJjdWxhcikge1xuICAgICAgdGhpcy5yYW5nZSA9IHRoaXMuZ2V0UmFuZ2Uoc2VyaWVzLCBvcHRpb25zKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldFNlcmllc0J5VHlwZShzZXJpZXM6IEFycmF5PFBvQ2hhcnRTZXJpZT4pIHtcbiAgICB0aGlzLnNlcmllc0J5VHlwZSA9IHtcbiAgICAgIFtQb0NoYXJ0VHlwZS5BcmVhXTogc2VyaWVzLmZpbHRlcihzZXJpZSA9PiBzZXJpZS50eXBlID09PSBQb0NoYXJ0VHlwZS5BcmVhKSxcbiAgICAgIFtQb0NoYXJ0VHlwZS5Db2x1bW5dOiBzZXJpZXMuZmlsdGVyKHNlcmllID0+IHNlcmllLnR5cGUgPT09IFBvQ2hhcnRUeXBlLkNvbHVtbiksXG4gICAgICBbUG9DaGFydFR5cGUuQmFyXTogc2VyaWVzLmZpbHRlcihzZXJpZSA9PiBzZXJpZS50eXBlID09PSBQb0NoYXJ0VHlwZS5CYXIpLFxuICAgICAgW1BvQ2hhcnRUeXBlLkxpbmVdOiBzZXJpZXMuZmlsdGVyKHNlcmllID0+IHNlcmllLnR5cGUgPT09IFBvQ2hhcnRUeXBlLkxpbmUpLFxuICAgICAgW1BvQ2hhcnRUeXBlLkRvbnV0XTogc2VyaWVzLmZpbHRlcihzZXJpZSA9PiBzZXJpZS50eXBlID09PSBQb0NoYXJ0VHlwZS5Eb251dCksXG4gICAgICBbUG9DaGFydFR5cGUuUGllXTogc2VyaWVzLmZpbHRlcihzZXJpZSA9PiBzZXJpZS50eXBlID09PSBQb0NoYXJ0VHlwZS5QaWUpXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0Vmlld0JveCgpIHtcbiAgICBjb25zdCB7IHN2Z1dpZHRoLCBzdmdIZWlnaHQgfSA9IHRoaXMuY29udGFpbmVyU2l6ZTtcbiAgICBjb25zdCB2aWV3Qm94V2lkdGggPSB0aGlzLmlzVHlwZUNpcmN1bGFyID8gc3ZnSGVpZ2h0IDogc3ZnV2lkdGg7XG4gICAgLy8gVHJhdGFtZW50byBuZWNlc3PDoXJpbyBwYXJhIHF1ZSBuw6NvIGNvcnRlIG8gdmV0b3IgbmFzIGV4dHJlbWlkYWRlc1xuICAgIGNvbnN0IG9mZnNldFhZID0gMTtcblxuICAgIHRoaXMudmlld0JveCA9IGAke29mZnNldFhZfSAtJHtvZmZzZXRYWX0gJHt2aWV3Qm94V2lkdGh9ICR7dGhpcy5jb250YWluZXJTaXplLnN2Z0hlaWdodH1gO1xuICB9XG5cbiAgcHJpdmF0ZSB2ZXJpZnlBeGlzT3B0aW9ucyhvcHRpb25zOiBQb0NoYXJ0T3B0aW9ucyk6IHZvaWQge1xuICAgIGlmICghdGhpcy5pc1R5cGVDaXJjdWxhciAmJiBvcHRpb25zLmhhc093blByb3BlcnR5KCdheGlzJykpIHtcbiAgICAgIHRoaXMucmFuZ2UgPSB0aGlzLmdldFJhbmdlKHRoaXMuc2VyaWVzLCB0aGlzLm9wdGlvbnMpO1xuICAgICAgdGhpcy5heGlzT3B0aW9ucyA9IHtcbiAgICAgICAgLi4udGhpcy5heGlzT3B0aW9ucyxcbiAgICAgICAgLi4ub3B0aW9ucy5heGlzXG4gICAgICB9O1xuICAgIH1cbiAgfVxufVxuIiwiPHN2ZzpzdmdcbiAgI3N2Z0VMZW1lbnRcbiAgY2xhc3M9XCJwby1jaGFydC1zdmctZWxlbWVudFwiXG4gIHByZXNlcnZlQXNwZWN0UmF0aW89XCJ4TWlkWU1pbiBtZWV0XCJcbiAgW2F0dHIudmlld0JveF09XCJ2aWV3Qm94XCJcbiAgW2F0dHIud2lkdGhdPVwiY29udGFpbmVyU2l6ZS5zdmdXaWR0aFwiXG4gIFthdHRyLmhlaWdodF09XCJjb250YWluZXJTaXplLnN2Z0hlaWdodFwiXG4+XG4gIDwhLS0gYXhpcyAtLT5cbiAgPHN2ZzpnXG4gICAgKm5nSWY9XCIhaXNUeXBlQ2lyY3VsYXJcIlxuICAgIHBvLWNoYXJ0LWF4aXNcbiAgICBbcC1hbGlnbi1ieS10aGUtY29ybmVyc109XCJhbGlnbkJ5VGhlQ29ybmVyc1wiXG4gICAgW3AtcmFuZ2VdPVwicmFuZ2VcIlxuICAgIFtwLXR5cGVdPVwidHlwZVwiXG4gICAgW3Atc2VyaWVzXT1cInNlcmllc1wiXG4gICAgW3AtY29udGFpbmVyLXNpemVdPVwiY29udGFpbmVyU2l6ZVwiXG4gICAgW3Atb3B0aW9uc109XCJheGlzT3B0aW9uc1wiXG4gICAgW3AtY2F0ZWdvcmllc109XCJjYXRlZ29yaWVzXCJcbiAgICAocC1jYXRlZ29yaWVzLWNvb3JkaW5hdGVzKT1cImdldENhdGVnb3JpZXNDb29yZGluYXRlcygkZXZlbnQpXCJcbiAgPjwvc3ZnOmc+XG5cbiAgPCEtLSBjaGFydCBhcmVhIC0tPlxuICA8c3ZnOmdcbiAgICAqbmdJZj1cIih0eXBlID09PSAnYXJlYScgfHwgdHlwZSA9PT0gJ2xpbmUnIHx8IHR5cGUgPT09ICdjb2x1bW4nKSAmJiBzZXJpZXNCeVR5cGVbJ2FyZWEnXS5sZW5ndGhcIlxuICAgIHBvLWNoYXJ0LWFyZWFcbiAgICBbcC1hbGlnbi1ieS10aGUtY29ybmVyc109XCJhbGlnbkJ5VGhlQ29ybmVyc1wiXG4gICAgW3Atc3ZnLXNwYWNlXT1cInN2Z1NwYWNlXCJcbiAgICBbcC1jYXRlZ29yaWVzXT1cImNhdGVnb3JpZXNcIlxuICAgIFtwLWNhdGVnb3JpZXMtY29vcmRpbmF0ZXNdPVwiY2F0ZWdvcmllc0Nvb3JkaW5hdGVzXCJcbiAgICBbcC1yYW5nZV09XCJyYW5nZVwiXG4gICAgW3Atc2VyaWVzXT1cInNlcmllc0J5VHlwZVsnYXJlYSddXCJcbiAgICBbcC1jb250YWluZXItc2l6ZV09XCJjb250YWluZXJTaXplXCJcbiAgICAocC1iYXItaG92ZXIpPVwib25TZXJpZUhvdmVyKCRldmVudClcIlxuICAgIChwLWJhci1jbGljayk9XCJvblNlcmllQ2xpY2soJGV2ZW50KVwiXG4gID48L3N2ZzpnPlxuXG4gIDwhLS0gY2hhcnQgY29sdW1uIC0tPlxuICA8c3ZnOmdcbiAgICAqbmdJZj1cIih0eXBlID09PSAnYXJlYScgfHwgdHlwZSA9PT0gJ2xpbmUnIHx8IHR5cGUgPT09ICdjb2x1bW4nKSAmJiBzZXJpZXNCeVR5cGVbJ2NvbHVtbiddLmxlbmd0aFwiXG4gICAgcG8tY2hhcnQtY29sdW1uXG4gICAgW3AtY2F0ZWdvcmllc109XCJjYXRlZ29yaWVzXCJcbiAgICBbcC1yYW5nZV09XCJyYW5nZVwiXG4gICAgW3Atc2VyaWVzXT1cInNlcmllc0J5VHlwZVsnY29sdW1uJ11cIlxuICAgIFtwLWNvbnRhaW5lci1zaXplXT1cImNvbnRhaW5lclNpemVcIlxuICAgIChwLWJhci1ob3Zlcik9XCJvblNlcmllSG92ZXIoJGV2ZW50KVwiXG4gICAgKHAtYmFyLWNsaWNrKT1cIm9uU2VyaWVDbGljaygkZXZlbnQpXCJcbiAgPjwvc3ZnOmc+XG5cbiAgPCEtLSBjaGFydCBsaW5lIC0tPlxuICA8c3ZnOmdcbiAgICAqbmdJZj1cIih0eXBlID09PSAnYXJlYScgfHwgdHlwZSA9PT0gJ2xpbmUnIHx8IHR5cGUgPT09ICdjb2x1bW4nKSAmJiBzZXJpZXNCeVR5cGVbJ2xpbmUnXS5sZW5ndGhcIlxuICAgIHBvLWNoYXJ0LWxpbmVcbiAgICBbcC1jYXRlZ29yaWVzXT1cImNhdGVnb3JpZXNcIlxuICAgIFtwLXJhbmdlXT1cInJhbmdlXCJcbiAgICBbcC1zZXJpZXNdPVwic2VyaWVzQnlUeXBlWydsaW5lJ11cIlxuICAgIFtwLWNvbnRhaW5lci1zaXplXT1cImNvbnRhaW5lclNpemVcIlxuICAgIChwLXBvaW50LWhvdmVyKT1cIm9uU2VyaWVIb3ZlcigkZXZlbnQpXCJcbiAgICAocC1wb2ludC1jbGljayk9XCJvblNlcmllQ2xpY2soJGV2ZW50KVwiXG4gID48L3N2ZzpnPlxuXG4gIDwhLS0gY2hhcnQgYmFyIC0tPlxuICA8c3ZnOmdcbiAgICAqbmdJZj1cInR5cGUgPT09ICdiYXInXCJcbiAgICBwby1jaGFydC1iYXJcbiAgICBbcC1jYXRlZ29yaWVzXT1cImNhdGVnb3JpZXNcIlxuICAgIFtwLXJhbmdlXT1cInJhbmdlXCJcbiAgICBbcC1zZXJpZXNdPVwic2VyaWVzQnlUeXBlWydiYXInXVwiXG4gICAgW3AtY29udGFpbmVyLXNpemVdPVwiY29udGFpbmVyU2l6ZVwiXG4gICAgKHAtYmFyLWhvdmVyKT1cIm9uU2VyaWVIb3ZlcigkZXZlbnQpXCJcbiAgICAocC1iYXItY2xpY2spPVwib25TZXJpZUNsaWNrKCRldmVudClcIlxuICA+PC9zdmc6Zz5cblxuICA8c3ZnOmdcbiAgICAqbmdJZj1cInR5cGUgPT09ICdwaWUnXCJcbiAgICBwby1jaGFydC1waWVcbiAgICBbcC1zZXJpZXNdPVwic2VyaWVzQnlUeXBlWydwaWUnXVwiXG4gICAgW3AtY29udGFpbmVyLXNpemVdPVwiY29udGFpbmVyU2l6ZVwiXG4gICAgKHAtY2lyY3VsYXItaG92ZXIpPVwib25TZXJpZUhvdmVyKCRldmVudClcIlxuICAgIChwLWNpcmN1bGFyLWNsaWNrKT1cIm9uU2VyaWVDbGljaygkZXZlbnQpXCJcbiAgPjwvc3ZnOmc+XG5cbiAgPHN2ZzpnXG4gICAgKm5nSWY9XCJ0eXBlID09PSAnZG9udXQnXCJcbiAgICBwby1jaGFydC1kb251dFxuICAgIFtwLW9wdGlvbnNdPVwib3B0aW9uc1wiXG4gICAgW3Atc2VyaWVzXT1cInNlcmllc0J5VHlwZVsnZG9udXQnXVwiXG4gICAgW3AtY29udGFpbmVyLXNpemVdPVwiY29udGFpbmVyU2l6ZVwiXG4gICAgKHAtY2lyY3VsYXItaG92ZXIpPVwib25TZXJpZUhvdmVyKCRldmVudClcIlxuICAgIChwLWNpcmN1bGFyLWNsaWNrKT1cIm9uU2VyaWVDbGljaygkZXZlbnQpXCJcbiAgPjwvc3ZnOmc+XG48L3N2Zzpzdmc+XG4iXX0=