import { ChangeDetectionStrategy, Component, ViewChild, ViewContainerRef } from '@angular/core';
import { fromEvent } from 'rxjs';
import { debounceTime, filter, switchMap, tap } from 'rxjs/operators';
import { PoLookupModalBaseComponent } from '../po-lookup-modal/po-lookup-modal-base.component';
import { PoDynamicFormComponent } from './../../../po-dynamic/po-dynamic-form/po-dynamic-form.component';
import { PoTableComponent } from './../../../po-table/po-table.component';
import * as i0 from "@angular/core";
import * as i1 from "./../../../../services/po-language/po-language.service";
import * as i2 from "../../../po-modal/po-modal.component";
import * as i3 from "../../po-field-container/po-field-container.component";
import * as i4 from "@angular/forms";
import * as i5 from "@angular/common";
import * as i6 from "../../../po-disclaimer-group/po-disclaimer-group.component";
import * as i7 from "../../../po-table/po-table.component";
const _c0 = ["inpsearch"];
const _c1 = ["container"];
function PoLookupModalComponent_div_9_Template(rf, ctx) { if (rf & 1) {
    const _r8 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "div", 16)(1, "span", 17);
    i0.ɵɵlistener("click", function PoLookupModalComponent_div_9_Template_span_click_1_listener() { i0.ɵɵrestoreView(_r8); const ctx_r7 = i0.ɵɵnextContext(); return ctx_r7.onAdvancedFilter(); })("keydown.enter", function PoLookupModalComponent_div_9_Template_span_keydown_enter_1_listener() { i0.ɵɵrestoreView(_r8); const ctx_r9 = i0.ɵɵnextContext(); return ctx_r9.onAdvancedFilter(); });
    i0.ɵɵtext(2);
    i0.ɵɵelementEnd()();
} if (rf & 2) {
    const ctx_r2 = i0.ɵɵnextContext();
    i0.ɵɵadvance(2);
    i0.ɵɵtextInterpolate1(" ", ctx_r2.literals.modalAdvancedSearch, " ");
} }
function PoLookupModalComponent_po_disclaimer_group_10_Template(rf, ctx) { if (rf & 1) {
    const _r11 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "po-disclaimer-group", 18);
    i0.ɵɵlistener("p-change", function PoLookupModalComponent_po_disclaimer_group_10_Template_po_disclaimer_group_p_change_0_listener() { i0.ɵɵrestoreView(_r11); const ctx_r10 = i0.ɵɵnextContext(); return ctx_r10.onChangeDisclaimerGroup(); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-disclaimers", ctx_r3.disclaimerGroup == null ? null : ctx_r3.disclaimerGroup.disclaimers)("p-title", ctx_r3.disclaimerGroup == null ? null : ctx_r3.disclaimerGroup.title);
} }
function PoLookupModalComponent_po_disclaimer_group_14_Template(rf, ctx) { if (rf & 1) {
    const _r13 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "po-disclaimer-group", 19);
    i0.ɵɵlistener("p-remove", function PoLookupModalComponent_po_disclaimer_group_14_Template_po_disclaimer_group_p_remove_0_listener($event) { i0.ɵɵrestoreView(_r13); const ctx_r12 = i0.ɵɵnextContext(); return ctx_r12.onUnselectFromDisclaimer($event.removedDisclaimer); })("p-remove-all", function PoLookupModalComponent_po_disclaimer_group_14_Template_po_disclaimer_group_p_remove_all_0_listener($event) { i0.ɵɵrestoreView(_r13); const ctx_r14 = i0.ɵɵnextContext(); return ctx_r14.onAllUnselected($event); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r5 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-disclaimers", ctx_r5.selecteds);
} }
/**
 * @docsPrivate
 *
 * @docsExtends PoLookupModalBaseComponent
 */
export class PoLookupModalComponent extends PoLookupModalBaseComponent {
    constructor(componentFactory, poLanguage, changeDetector) {
        super(poLanguage, changeDetector);
        this.componentFactory = componentFactory;
        this.keyUpObservable = null;
        this.containerHeight = 375;
    }
    ngOnInit() {
        super.ngOnInit();
        this.setTableHeight();
    }
    ngAfterViewInit() {
        this.initializeEventInput();
    }
    // Seleciona um item na tabela
    onSelect(item) {
        if (this.multiple) {
            this.selecteds = [...this.selecteds, { value: item[this.fieldValue], label: item[this.fieldLabel], ...item }];
        }
        else {
            this.selecteds = [{ value: item[this.fieldValue], label: item[this.fieldLabel], ...item }];
        }
    }
    // Remove a seleção de um item na tabela
    onUnselect(unselectedItem) {
        this.selecteds = this.selecteds.filter(itemSelected => itemSelected.value !== unselectedItem[this.fieldValue]);
    }
    onUnselectFromDisclaimer(removedDisclaimer) {
        this.poTable.unselectRowItem(item => item[this.fieldValue] === removedDisclaimer.value);
    }
    // Seleciona todos os itens visíveis na tabela
    onAllSelected(items) {
        this.selecteds = items.map(item => ({ value: item[this.fieldValue], label: item[this.fieldLabel], ...item }));
    }
    // Remove a seleção de todos os itens visíveis na tabela
    onAllUnselected(items) {
        this.poTable.unselectRows();
        this.selecteds = [];
    }
    initializeEventInput() {
        this.keyUpObservable = fromEvent(this.inputSearchEl.nativeElement, 'keyup').pipe(filter((e) => this.validateEnterPressed(e)), debounceTime(400));
        this.keyUpObservable.subscribe(() => {
            this.search();
        });
    }
    openModal() {
        this.poModal.open();
    }
    sortBy(sort) {
        this.sort = sort;
    }
    destroyDynamicForm() {
        if (this.componentRef) {
            this.componentRef.destroy();
        }
    }
    onAdvancedFilter() {
        this.setupModalAdvancedFilter();
        this.createDynamicForm();
    }
    setTableHeight() {
        if (this.multiple) {
            if (this.selecteds?.length !== 0) {
                this.tableHeight = 300;
            }
            else {
                this.tableHeight = 370;
                this.containerHeight = 375;
            }
        }
        // precisa ser 315 por as linhas terem altura de 32px (quando tela menor que 1366px).
        // O retorno padrão é 10 itens fazendo com que gere scroll caso houver paginação, 370 não gerava.
        this.tableHeight = this.infiniteScroll ? 315 : 370;
        if (window.innerHeight < 615) {
            this.tableHeight -= 50;
            this.containerHeight -= 50;
        }
    }
    validateEnterPressed(e) {
        return e.keyCode === 13;
    }
    setupModalAdvancedFilter() {
        this.dynamicFormValue = {};
        this.isAdvancedFilter = true;
    }
    createDynamicForm() {
        const component = this.componentFactory.resolveComponentFactory(PoDynamicFormComponent);
        this.componentRef = this.container.createComponent(component);
        this.componentRef.instance.fields = this.advancedFilters;
        this.componentRef.instance.value = this.dynamicFormValue;
        this.componentRef.instance.formOutput
            .pipe(tap(form => {
            this.dynamicForm = form;
            this.primaryActionAdvancedFilter.disabled = this.dynamicForm.invalid;
        }), switchMap(form => form.valueChanges))
            .subscribe(() => {
            this.primaryActionAdvancedFilter.disabled = this.dynamicForm.invalid;
        });
        this.changeDetector.markForCheck();
    }
}
PoLookupModalComponent.ɵfac = function PoLookupModalComponent_Factory(t) { return new (t || PoLookupModalComponent)(i0.ɵɵdirectiveInject(i0.ComponentFactoryResolver), i0.ɵɵdirectiveInject(i1.PoLanguageService), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef)); };
PoLookupModalComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoLookupModalComponent, selectors: [["po-lookup-modal"]], viewQuery: function PoLookupModalComponent_Query(rf, ctx) { if (rf & 1) {
        i0.ɵɵviewQuery(PoTableComponent, 7);
        i0.ɵɵviewQuery(_c0, 5);
        i0.ɵɵviewQuery(_c1, 5, ViewContainerRef);
    } if (rf & 2) {
        let _t;
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.poTable = _t.first);
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.inputSearchEl = _t.first);
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.container = _t.first);
    } }, features: [i0.ɵɵInheritDefinitionFeature], decls: 18, vars: 24, consts: [["p-click-out", "false", "p-hide-close", "false", "p-size", "lg", 3, "p-primary-action", "p-secondary-action", "p-title"], [3, "hidden"], [1, "po-lookup-header", "po-pull-right", 3, "p-optional"], [1, "po-lookup-filter-content"], [1, "po-field-icon-container-right"], [1, "po-icon", "po-field-icon", "po-icon-search", 3, "click"], ["iconLookup", ""], ["name", "contentSearch", "type", "text", 1, "po-input", "po-input-icon-right", 3, "ngModel", "placeholder", "ngModelChange"], ["inpsearch", ""], ["class", "po-lookup-advanced-search", 4, "ngIf"], ["class", "po-md-12", 3, "p-disclaimers", "p-title", "p-change", 4, "ngIf"], [1, "po-row", "po-lookup-container-table"], [1, "po-md-12", 3, "p-selectable", "p-hide-detail", "p-single-select", "p-sort", "p-columns", "p-height", "p-items", "p-literals", "p-loading", "p-show-more-disabled", "p-infinite-scroll", "p-selected", "p-unselected", "p-all-selected", "p-all-unselected", "p-show-more", "p-sort-by"], ["poTable", ""], ["class", "po-md-12", 3, "p-disclaimers", "p-remove", "p-remove-all", 4, "ngIf"], ["container", ""], [1, "po-lookup-advanced-search"], ["tabindex", "0", "tabindex", "0", 1, "po-lookup-advanced-search-link", 3, "click", "keydown.enter"], [1, "po-md-12", 3, "p-disclaimers", "p-title", "p-change"], [1, "po-md-12", 3, "p-disclaimers", "p-remove", "p-remove-all"]], template: function PoLookupModalComponent_Template(rf, ctx) { if (rf & 1) {
        i0.ɵɵelementStart(0, "po-modal", 0)(1, "div", 1)(2, "po-field-container", 2)(3, "div", 3)(4, "div", 4)(5, "span", 5, 6);
        i0.ɵɵlistener("click", function PoLookupModalComponent_Template_span_click_5_listener() { return ctx.search(); });
        i0.ɵɵelementEnd()();
        i0.ɵɵelementStart(7, "input", 7, 8);
        i0.ɵɵlistener("ngModelChange", function PoLookupModalComponent_Template_input_ngModelChange_7_listener($event) { return ctx.searchValue = $event; });
        i0.ɵɵelementEnd()();
        i0.ɵɵtemplate(9, PoLookupModalComponent_div_9_Template, 3, 1, "div", 9);
        i0.ɵɵelementEnd();
        i0.ɵɵtemplate(10, PoLookupModalComponent_po_disclaimer_group_10_Template, 1, 2, "po-disclaimer-group", 10);
        i0.ɵɵelementStart(11, "div", 11)(12, "po-table", 12, 13);
        i0.ɵɵlistener("p-selected", function PoLookupModalComponent_Template_po_table_p_selected_12_listener($event) { return ctx.onSelect($event); })("p-unselected", function PoLookupModalComponent_Template_po_table_p_unselected_12_listener($event) { return ctx.onUnselect($event); })("p-all-selected", function PoLookupModalComponent_Template_po_table_p_all_selected_12_listener($event) { return ctx.onAllSelected($event); })("p-all-unselected", function PoLookupModalComponent_Template_po_table_p_all_unselected_12_listener($event) { return ctx.onAllUnselected($event); })("p-show-more", function PoLookupModalComponent_Template_po_table_p_show_more_12_listener() { return ctx.showMoreEvent(); })("p-sort-by", function PoLookupModalComponent_Template_po_table_p_sort_by_12_listener($event) { return ctx.sortBy($event); });
        i0.ɵɵelementEnd()();
        i0.ɵɵtemplate(14, PoLookupModalComponent_po_disclaimer_group_14_Template, 1, 1, "po-disclaimer-group", 14);
        i0.ɵɵelementEnd();
        i0.ɵɵelementStart(15, "div", 1);
        i0.ɵɵelementContainer(16, null, 15);
        i0.ɵɵelementEnd()();
    } if (rf & 2) {
        i0.ɵɵproperty("p-primary-action", ctx.isAdvancedFilter ? ctx.primaryActionAdvancedFilter : ctx.primaryAction)("p-secondary-action", ctx.isAdvancedFilter ? ctx.secondaryActionAdvancedFilter : ctx.secondaryAction)("p-title", ctx.isAdvancedFilter ? ctx.advancedFilterModalTitle : ctx.title);
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("hidden", ctx.isAdvancedFilter);
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("p-optional", false);
        i0.ɵɵadvance(5);
        i0.ɵɵproperty("ngModel", ctx.searchValue)("placeholder", ctx.literals.modalPlaceholder);
        i0.ɵɵadvance(2);
        i0.ɵɵproperty("ngIf", ctx.advancedFilters && ctx.advancedFilters.length > 0);
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngIf", !!ctx.disclaimerGroup);
        i0.ɵɵadvance(1);
        i0.ɵɵstyleProp("height", ctx.containerHeight, "px");
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("p-selectable", true)("p-hide-detail", true)("p-single-select", !ctx.multiple)("p-sort", true)("p-columns", ctx.columns)("p-height", ctx.tableHeight)("p-items", ctx.items)("p-literals", ctx.tableLiterals)("p-loading", ctx.isLoading)("p-show-more-disabled", !ctx.hasNext)("p-infinite-scroll", ctx.infiniteScroll);
        i0.ɵɵadvance(2);
        i0.ɵɵproperty("ngIf", ctx.multiple);
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("hidden", !ctx.isAdvancedFilter);
    } }, directives: [i2.PoModalComponent, i3.PoFieldContainerComponent, i4.DefaultValueAccessor, i4.NgControlStatus, i4.NgModel, i5.NgIf, i6.PoDisclaimerGroupComponent, i7.PoTableComponent], encapsulation: 2, changeDetection: 0 });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoLookupModalComponent, [{
        type: Component,
        args: [{ selector: 'po-lookup-modal', changeDetection: ChangeDetectionStrategy.OnPush, template: "<po-modal\n  p-click-out=\"false\"\n  p-hide-close=\"false\"\n  p-size=\"lg\"\n  [p-primary-action]=\"isAdvancedFilter ? primaryActionAdvancedFilter : primaryAction\"\n  [p-secondary-action]=\"isAdvancedFilter ? secondaryActionAdvancedFilter : secondaryAction\"\n  [p-title]=\"isAdvancedFilter ? advancedFilterModalTitle : title\"\n>\n  <div [hidden]=\"isAdvancedFilter\">\n    <po-field-container class=\"po-lookup-header po-pull-right\" [p-optional]=\"false\">\n      <div class=\"po-lookup-filter-content\">\n        <div class=\"po-field-icon-container-right\">\n          <span #iconLookup class=\"po-icon po-field-icon po-icon-search\" (click)=\"search()\"> </span>\n        </div>\n\n        <input\n          #inpsearch\n          class=\"po-input po-input-icon-right\"\n          name=\"contentSearch\"\n          [(ngModel)]=\"searchValue\"\n          [placeholder]=\"literals.modalPlaceholder\"\n          type=\"text\"\n        />\n      </div>\n\n      <div *ngIf=\"advancedFilters && advancedFilters.length > 0\" class=\"po-lookup-advanced-search\">\n        <span\n          class=\"po-lookup-advanced-search-link\"\n          tabindex=\"0\"\n          (click)=\"onAdvancedFilter()\"\n          (keydown.enter)=\"onAdvancedFilter()\"\n          tabindex=\"0\"\n        >\n          {{ literals.modalAdvancedSearch }}\n        </span>\n      </div>\n    </po-field-container>\n\n    <!-- DISCLAIMER -->\n    <po-disclaimer-group\n      *ngIf=\"!!disclaimerGroup\"\n      class=\"po-md-12\"\n      [p-disclaimers]=\"disclaimerGroup?.disclaimers\"\n      [p-title]=\"disclaimerGroup?.title\"\n      (p-change)=\"onChangeDisclaimerGroup()\"\n    >\n    </po-disclaimer-group>\n\n    <div class=\"po-row po-lookup-container-table\" [style.height.px]=\"containerHeight\">\n      <po-table\n        #poTable\n        class=\"po-md-12\"\n        [p-selectable]=\"true\"\n        [p-hide-detail]=\"true\"\n        [p-single-select]=\"!multiple\"\n        [p-sort]=\"true\"\n        [p-columns]=\"columns\"\n        [p-height]=\"tableHeight\"\n        [p-items]=\"items\"\n        [p-literals]=\"tableLiterals\"\n        [p-loading]=\"isLoading\"\n        [p-show-more-disabled]=\"!hasNext\"\n        [p-infinite-scroll]=\"infiniteScroll\"\n        (p-selected)=\"onSelect($event)\"\n        (p-unselected)=\"onUnselect($event)\"\n        (p-all-selected)=\"onAllSelected($event)\"\n        (p-all-unselected)=\"onAllUnselected($event)\"\n        (p-show-more)=\"showMoreEvent()\"\n        (p-sort-by)=\"sortBy($event)\"\n      >\n      </po-table>\n    </div>\n\n    <!-- DISCLAIMER -->\n    <po-disclaimer-group\n      *ngIf=\"multiple\"\n      class=\"po-md-12\"\n      [p-disclaimers]=\"selecteds\"\n      (p-remove)=\"onUnselectFromDisclaimer($event.removedDisclaimer)\"\n      (p-remove-all)=\"onAllUnselected($event)\"\n    >\n    </po-disclaimer-group>\n  </div>\n  <div [hidden]=\"!isAdvancedFilter\">\n    <ng-container #container> </ng-container>\n  </div>\n</po-modal>\n" }]
    }], function () { return [{ type: i0.ComponentFactoryResolver }, { type: i1.PoLanguageService }, { type: i0.ChangeDetectorRef }]; }, { poTable: [{
            type: ViewChild,
            args: [PoTableComponent, { static: true }]
        }], inputSearchEl: [{
            type: ViewChild,
            args: ['inpsearch']
        }], container: [{
            type: ViewChild,
            args: ['container', { read: ViewContainerRef }]
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tbG9va3VwLW1vZGFsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1maWVsZC9wby1sb29rdXAvcG8tbG9va3VwLW1vZGFsL3BvLWxvb2t1cC1tb2RhbC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL2NvbXBvbmVudHMvcG8tZmllbGQvcG8tbG9va3VwL3BvLWxvb2t1cC1tb2RhbC9wby1sb29rdXAtbW9kYWwuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVMLHVCQUF1QixFQUV2QixTQUFTLEVBS1QsU0FBUyxFQUNULGdCQUFnQixFQUNqQixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsU0FBUyxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQzdDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV0RSxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxtREFBbUQsQ0FBQztBQUUvRixPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxpRUFBaUUsQ0FBQztBQUN6RyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQzs7Ozs7Ozs7Ozs7OztJQ01wRSwrQkFBNkYsZUFBQTtJQUl6RixpS0FBUyx5QkFBa0IsSUFBQyxvS0FDWCx5QkFBa0IsSUFEUDtJQUk1QixZQUNGO0lBQUEsaUJBQU8sRUFBQTs7O0lBREwsZUFDRjtJQURFLG9FQUNGOzs7O0lBS0osK0NBTUM7SUFEQyx5TUFBWSxpQ0FBeUIsSUFBQztJQUV4QyxpQkFBc0I7OztJQUpwQiwwR0FBOEMsaUZBQUE7Ozs7SUFnQ2hELCtDQU1DO0lBRkMsK01BQVksMERBQWtELElB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cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgQ29tcG9uZW50UmVmLFxuICBFbGVtZW50UmVmLFxuICBPbkluaXQsXG4gIFZpZXdDaGlsZCxcbiAgVmlld0NvbnRhaW5lclJlZlxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE5nRm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IGZyb21FdmVudCwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZGVib3VuY2VUaW1lLCBmaWx0ZXIsIHN3aXRjaE1hcCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgUG9UYWJsZUNvbHVtblNvcnQgfSBmcm9tICcuLi8uLi8uLi9wby10YWJsZS9pbnRlcmZhY2VzL3BvLXRhYmxlLWNvbHVtbi1zb3J0LmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb0xvb2t1cE1vZGFsQmFzZUNvbXBvbmVudCB9IGZyb20gJy4uL3BvLWxvb2t1cC1tb2RhbC9wby1sb29rdXAtbW9kYWwtYmFzZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgUG9MYW5ndWFnZVNlcnZpY2UgfSBmcm9tICcuLy4uLy4uLy4uLy4uL3NlcnZpY2VzL3BvLWxhbmd1YWdlL3BvLWxhbmd1YWdlLnNlcnZpY2UnO1xuaW1wb3J0IHsgUG9EeW5hbWljRm9ybUNvbXBvbmVudCB9IGZyb20gJy4vLi4vLi4vLi4vcG8tZHluYW1pYy9wby1keW5hbWljLWZvcm0vcG8tZHluYW1pYy1mb3JtLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb1RhYmxlQ29tcG9uZW50IH0gZnJvbSAnLi8uLi8uLi8uLi9wby10YWJsZS9wby10YWJsZS5jb21wb25lbnQnO1xuXG4vKipcbiAqIEBkb2NzUHJpdmF0ZVxuICpcbiAqIEBkb2NzRXh0ZW5kcyBQb0xvb2t1cE1vZGFsQmFzZUNvbXBvbmVudFxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwby1sb29rdXAtbW9kYWwnLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tbG9va3VwLW1vZGFsLmNvbXBvbmVudC5odG1sJyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcbn0pXG5leHBvcnQgY2xhc3MgUG9Mb29rdXBNb2RhbENvbXBvbmVudCBleHRlbmRzIFBvTG9va3VwTW9kYWxCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcbiAgQFZpZXdDaGlsZChQb1RhYmxlQ29tcG9uZW50LCB7IHN0YXRpYzogdHJ1ZSB9KSBwb1RhYmxlOiBQb1RhYmxlQ29tcG9uZW50O1xuICBAVmlld0NoaWxkKCdpbnBzZWFyY2gnKSBpbnB1dFNlYXJjaEVsOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdjb250YWluZXInLCB7IHJlYWQ6IFZpZXdDb250YWluZXJSZWYgfSkgY29udGFpbmVyOiBWaWV3Q29udGFpbmVyUmVmO1xuXG4gIGtleVVwT2JzZXJ2YWJsZTogT2JzZXJ2YWJsZTxhbnk+ID0gbnVsbDtcblxuICBjb250YWluZXJIZWlnaHQ6IG51bWJlciA9IDM3NTtcbiAgdGFibGVIZWlnaHQ6IG51bWJlcjtcblxuICBjb21wb25lbnRSZWY6IENvbXBvbmVudFJlZjxQb0R5bmFtaWNGb3JtQ29tcG9uZW50PjtcbiAgZHluYW1pY0Zvcm06IE5nRm9ybTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGNvbXBvbmVudEZhY3Rvcnk6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICBwb0xhbmd1YWdlOiBQb0xhbmd1YWdlU2VydmljZSxcbiAgICBjaGFuZ2VEZXRlY3RvcjogQ2hhbmdlRGV0ZWN0b3JSZWZcbiAgKSB7XG4gICAgc3VwZXIocG9MYW5ndWFnZSwgY2hhbmdlRGV0ZWN0b3IpO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgc3VwZXIubmdPbkluaXQoKTtcbiAgICB0aGlzLnNldFRhYmxlSGVpZ2h0KCk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5pbml0aWFsaXplRXZlbnRJbnB1dCgpO1xuICB9XG5cbiAgLy8gU2VsZWNpb25hIHVtIGl0ZW0gbmEgdGFiZWxhXG4gIG9uU2VsZWN0KGl0ZW0pIHtcbiAgICBpZiAodGhpcy5tdWx0aXBsZSkge1xuICAgICAgdGhpcy5zZWxlY3RlZHMgPSBbLi4udGhpcy5zZWxlY3RlZHMsIHsgdmFsdWU6IGl0ZW1bdGhpcy5maWVsZFZhbHVlXSwgbGFiZWw6IGl0ZW1bdGhpcy5maWVsZExhYmVsXSwgLi4uaXRlbSB9XTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZWxlY3RlZHMgPSBbeyB2YWx1ZTogaXRlbVt0aGlzLmZpZWxkVmFsdWVdLCBsYWJlbDogaXRlbVt0aGlzLmZpZWxkTGFiZWxdLCAuLi5pdGVtIH1dO1xuICAgIH1cbiAgfVxuXG4gIC8vIFJlbW92ZSBhIHNlbGXDp8OjbyBkZSB1bSBpdGVtIG5hIHRhYmVsYVxuICBvblVuc2VsZWN0KHVuc2VsZWN0ZWRJdGVtKSB7XG4gICAgdGhpcy5zZWxlY3RlZHMgPSB0aGlzLnNlbGVjdGVkcy5maWx0ZXIoaXRlbVNlbGVjdGVkID0+IGl0ZW1TZWxlY3RlZC52YWx1ZSAhPT0gdW5zZWxlY3RlZEl0ZW1bdGhpcy5maWVsZFZhbHVlXSk7XG4gIH1cblxuICBvblVuc2VsZWN0RnJvbURpc2NsYWltZXIocmVtb3ZlZERpc2NsYWltZXIpIHtcbiAgICB0aGlzLnBvVGFibGUudW5zZWxlY3RSb3dJdGVtKGl0ZW0gPT4gaXRlbVt0aGlzLmZpZWxkVmFsdWVdID09PSByZW1vdmVkRGlzY2xhaW1lci52YWx1ZSk7XG4gIH1cblxuICAvLyBTZWxlY2lvbmEgdG9kb3Mgb3MgaXRlbnMgdmlzw612ZWlzIG5hIHRhYmVsYVxuICBvbkFsbFNlbGVjdGVkKGl0ZW1zKSB7XG4gICAgdGhpcy5zZWxlY3RlZHMgPSBpdGVtcy5tYXAoaXRlbSA9PiAoeyB2YWx1ZTogaXRlbVt0aGlzLmZpZWxkVmFsdWVdLCBsYWJlbDogaXRlbVt0aGlzLmZpZWxkTGFiZWxdLCAuLi5pdGVtIH0pKTtcbiAgfVxuXG4gIC8vIFJlbW92ZSBhIHNlbGXDp8OjbyBkZSB0b2RvcyBvcyBpdGVucyB2aXPDrXZlaXMgbmEgdGFiZWxhXG4gIG9uQWxsVW5zZWxlY3RlZChpdGVtcykge1xuICAgIHRoaXMucG9UYWJsZS51bnNlbGVjdFJvd3MoKTtcbiAgICB0aGlzLnNlbGVjdGVkcyA9IFtdO1xuICB9XG5cbiAgaW5pdGlhbGl6ZUV2ZW50SW5wdXQoKTogdm9pZCB7XG4gICAgdGhpcy5rZXlVcE9ic2VydmFibGUgPSBmcm9tRXZlbnQodGhpcy5pbnB1dFNlYXJjaEVsLm5hdGl2ZUVsZW1lbnQsICdrZXl1cCcpLnBpcGUoXG4gICAgICBmaWx0ZXIoKGU6IGFueSkgPT4gdGhpcy52YWxpZGF0ZUVudGVyUHJlc3NlZChlKSksXG4gICAgICBkZWJvdW5jZVRpbWUoNDAwKVxuICAgICk7XG5cbiAgICB0aGlzLmtleVVwT2JzZXJ2YWJsZS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgdGhpcy5zZWFyY2goKTtcbiAgICB9KTtcbiAgfVxuXG4gIG9wZW5Nb2RhbCgpIHtcbiAgICB0aGlzLnBvTW9kYWwub3BlbigpO1xuICB9XG5cbiAgc29ydEJ5KHNvcnQ6IFBvVGFibGVDb2x1bW5Tb3J0KSB7XG4gICAgdGhpcy5zb3J0ID0gc29ydDtcbiAgfVxuXG4gIGRlc3Ryb3lEeW5hbWljRm9ybSgpIHtcbiAgICBpZiAodGhpcy5jb21wb25lbnRSZWYpIHtcbiAgICAgIHRoaXMuY29tcG9uZW50UmVmLmRlc3Ryb3koKTtcbiAgICB9XG4gIH1cblxuICBvbkFkdmFuY2VkRmlsdGVyKCkge1xuICAgIHRoaXMuc2V0dXBNb2RhbEFkdmFuY2VkRmlsdGVyKCk7XG4gICAgdGhpcy5jcmVhdGVEeW5hbWljRm9ybSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRUYWJsZUhlaWdodCgpIHtcbiAgICBpZiAodGhpcy5tdWx0aXBsZSkge1xuICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRzPy5sZW5ndGggIT09IDApIHtcbiAgICAgICAgdGhpcy50YWJsZUhlaWdodCA9IDMwMDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMudGFibGVIZWlnaHQgPSAzNzA7XG4gICAgICAgIHRoaXMuY29udGFpbmVySGVpZ2h0ID0gMzc1O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIHByZWNpc2Egc2VyIDMxNSBwb3IgYXMgbGluaGFzIHRlcmVtIGFsdHVyYSBkZSAzMnB4IChxdWFuZG8gdGVsYSBtZW5vciBxdWUgMTM2NnB4KS5cbiAgICAvLyBPIHJldG9ybm8gcGFkcsOjbyDDqSAxMCBpdGVucyBmYXplbmRvIGNvbSBxdWUgZ2VyZSBzY3JvbGwgY2FzbyBob3V2ZXIgcGFnaW5hw6fDo28sIDM3MCBuw6NvIGdlcmF2YS5cbiAgICB0aGlzLnRhYmxlSGVpZ2h0ID0gdGhpcy5pbmZpbml0ZVNjcm9sbCA/IDMxNSA6IDM3MDtcbiAgICBpZiAod2luZG93LmlubmVySGVpZ2h0IDwgNjE1KSB7XG4gICAgICB0aGlzLnRhYmxlSGVpZ2h0IC09IDUwO1xuICAgICAgdGhpcy5jb250YWluZXJIZWlnaHQgLT0gNTA7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB2YWxpZGF0ZUVudGVyUHJlc3NlZChlOiBhbnkpIHtcbiAgICByZXR1cm4gZS5rZXlDb2RlID09PSAxMztcbiAgfVxuXG4gIHByaXZhdGUgc2V0dXBNb2RhbEFkdmFuY2VkRmlsdGVyKCkge1xuICAgIHRoaXMuZHluYW1pY0Zvcm1WYWx1ZSA9IHt9O1xuICAgIHRoaXMuaXNBZHZhbmNlZEZpbHRlciA9IHRydWU7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUR5bmFtaWNGb3JtKCkge1xuICAgIGNvbnN0IGNvbXBvbmVudCA9IHRoaXMuY29tcG9uZW50RmFjdG9yeS5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShQb0R5bmFtaWNGb3JtQ29tcG9uZW50KTtcblxuICAgIHRoaXMuY29tcG9uZW50UmVmID0gdGhpcy5jb250YWluZXIuY3JlYXRlQ29tcG9uZW50PFBvRHluYW1pY0Zvcm1Db21wb25lbnQ+KGNvbXBvbmVudCk7XG4gICAgdGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2UuZmllbGRzID0gdGhpcy5hZHZhbmNlZEZpbHRlcnM7XG4gICAgdGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2UudmFsdWUgPSB0aGlzLmR5bmFtaWNGb3JtVmFsdWU7XG5cbiAgICB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5mb3JtT3V0cHV0XG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKGZvcm0gPT4ge1xuICAgICAgICAgIHRoaXMuZHluYW1pY0Zvcm0gPSBmb3JtO1xuICAgICAgICAgIHRoaXMucHJpbWFyeUFjdGlvbkFkdmFuY2VkRmlsdGVyLmRpc2FibGVkID0gdGhpcy5keW5hbWljRm9ybS5pbnZhbGlkO1xuICAgICAgICB9KSxcbiAgICAgICAgc3dpdGNoTWFwKGZvcm0gPT4gZm9ybS52YWx1ZUNoYW5nZXMpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgdGhpcy5wcmltYXJ5QWN0aW9uQWR2YW5jZWRGaWx0ZXIuZGlzYWJsZWQgPSB0aGlzLmR5bmFtaWNGb3JtLmludmFsaWQ7XG4gICAgICB9KTtcbiAgICB0aGlzLmNoYW5nZURldGVjdG9yLm1hcmtGb3JDaGVjaygpO1xuICB9XG59XG4iLCI8cG8tbW9kYWxcbiAgcC1jbGljay1vdXQ9XCJmYWxzZVwiXG4gIHAtaGlkZS1jbG9zZT1cImZhbHNlXCJcbiAgcC1zaXplPVwibGdcIlxuICBbcC1wcmltYXJ5LWFjdGlvbl09XCJpc0FkdmFuY2VkRmlsdGVyID8gcHJpbWFyeUFjdGlvbkFkdmFuY2VkRmlsdGVyIDogcHJpbWFyeUFjdGlvblwiXG4gIFtwLXNlY29uZGFyeS1hY3Rpb25dPVwiaXNBZHZhbmNlZEZpbHRlciA/IHNlY29uZGFyeUFjdGlvbkFkdmFuY2VkRmlsdGVyIDogc2Vjb25kYXJ5QWN0aW9uXCJcbiAgW3AtdGl0bGVdPVwiaXNBZHZhbmNlZEZpbHRlciA/IGFkdmFuY2VkRmlsdGVyTW9kYWxUaXRsZSA6IHRpdGxlXCJcbj5cbiAgPGRpdiBbaGlkZGVuXT1cImlzQWR2YW5jZWRGaWx0ZXJcIj5cbiAgICA8cG8tZmllbGQtY29udGFpbmVyIGNsYXNzPVwicG8tbG9va3VwLWhlYWRlciBwby1wdWxsLXJpZ2h0XCIgW3Atb3B0aW9uYWxdPVwiZmFsc2VcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJwby1sb29rdXAtZmlsdGVyLWNvbnRlbnRcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInBvLWZpZWxkLWljb24tY29udGFpbmVyLXJpZ2h0XCI+XG4gICAgICAgICAgPHNwYW4gI2ljb25Mb29rdXAgY2xhc3M9XCJwby1pY29uIHBvLWZpZWxkLWljb24gcG8taWNvbi1zZWFyY2hcIiAoY2xpY2spPVwic2VhcmNoKClcIj4gPC9zcGFuPlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8aW5wdXRcbiAgICAgICAgICAjaW5wc2VhcmNoXG4gICAgICAgICAgY2xhc3M9XCJwby1pbnB1dCBwby1pbnB1dC1pY29uLXJpZ2h0XCJcbiAgICAgICAgICBuYW1lPVwiY29udGVudFNlYXJjaFwiXG4gICAgICAgICAgWyhuZ01vZGVsKV09XCJzZWFyY2hWYWx1ZVwiXG4gICAgICAgICAgW3BsYWNlaG9sZGVyXT1cImxpdGVyYWxzLm1vZGFsUGxhY2Vob2xkZXJcIlxuICAgICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2ICpuZ0lmPVwiYWR2YW5jZWRGaWx0ZXJzICYmIGFkdmFuY2VkRmlsdGVycy5sZW5ndGggPiAwXCIgY2xhc3M9XCJwby1sb29rdXAtYWR2YW5jZWQtc2VhcmNoXCI+XG4gICAgICAgIDxzcGFuXG4gICAgICAgICAgY2xhc3M9XCJwby1sb29rdXAtYWR2YW5jZWQtc2VhcmNoLWxpbmtcIlxuICAgICAgICAgIHRhYmluZGV4PVwiMFwiXG4gICAgICAgICAgKGNsaWNrKT1cIm9uQWR2YW5jZWRGaWx0ZXIoKVwiXG4gICAgICAgICAgKGtleWRvd24uZW50ZXIpPVwib25BZHZhbmNlZEZpbHRlcigpXCJcbiAgICAgICAgICB0YWJpbmRleD1cIjBcIlxuICAgICAgICA+XG4gICAgICAgICAge3sgbGl0ZXJhbHMubW9kYWxBZHZhbmNlZFNlYXJjaCB9fVxuICAgICAgICA8L3NwYW4+XG4gICAgICA8L2Rpdj5cbiAgICA8L3BvLWZpZWxkLWNvbnRhaW5lcj5cblxuICAgIDwhLS0gRElTQ0xBSU1FUiAtLT5cbiAgICA8cG8tZGlzY2xhaW1lci1ncm91cFxuICAgICAgKm5nSWY9XCIhIWRpc2NsYWltZXJHcm91cFwiXG4gICAgICBjbGFzcz1cInBvLW1kLTEyXCJcbiAgICAgIFtwLWRpc2NsYWltZXJzXT1cImRpc2NsYWltZXJHcm91cD8uZGlzY2xhaW1lcnNcIlxuICAgICAgW3AtdGl0bGVdPVwiZGlzY2xhaW1lckdyb3VwPy50aXRsZVwiXG4gICAgICAocC1jaGFuZ2UpPVwib25DaGFuZ2VEaXNjbGFpbWVyR3JvdXAoKVwiXG4gICAgPlxuICAgIDwvcG8tZGlzY2xhaW1lci1ncm91cD5cblxuICAgIDxkaXYgY2xhc3M9XCJwby1yb3cgcG8tbG9va3VwLWNvbnRhaW5lci10YWJsZVwiIFtzdHlsZS5oZWlnaHQucHhdPVwiY29udGFpbmVySGVpZ2h0XCI+XG4gICAgICA8cG8tdGFibGVcbiAgICAgICAgI3BvVGFibGVcbiAgICAgICAgY2xhc3M9XCJwby1tZC0xMlwiXG4gICAgICAgIFtwLXNlbGVjdGFibGVdPVwidHJ1ZVwiXG4gICAgICAgIFtwLWhpZGUtZGV0YWlsXT1cInRydWVcIlxuICAgICAgICBbcC1zaW5nbGUtc2VsZWN0XT1cIiFtdWx0aXBsZVwiXG4gICAgICAgIFtwLXNvcnRdPVwidHJ1ZVwiXG4gICAgICAgIFtwLWNvbHVtbnNdPVwiY29sdW1uc1wiXG4gICAgICAgIFtwLWhlaWdodF09XCJ0YWJsZUhlaWdodFwiXG4gICAgICAgIFtwLWl0ZW1zXT1cIml0ZW1zXCJcbiAgICAgICAgW3AtbGl0ZXJhbHNdPVwidGFibGVMaXRlcmFsc1wiXG4gICAgICAgIFtwLWxvYWRpbmddPVwiaXNMb2FkaW5nXCJcbiAgICAgICAgW3Atc2hvdy1tb3JlLWRpc2FibGVkXT1cIiFoYXNOZXh0XCJcbiAgICAgICAgW3AtaW5maW5pdGUtc2Nyb2xsXT1cImluZmluaXRlU2Nyb2xsXCJcbiAgICAgICAgKHAtc2VsZWN0ZWQpPVwib25TZWxlY3QoJGV2ZW50KVwiXG4gICAgICAgIChwLXVuc2VsZWN0ZWQpPVwib25VbnNlbGVjdCgkZXZlbnQpXCJcbiAgICAgICAgKHAtYWxsLXNlbGVjdGVkKT1cIm9uQWxsU2VsZWN0ZWQoJGV2ZW50KVwiXG4gICAgICAgIChwLWFsbC11bnNlbGVjdGVkKT1cIm9uQWxsVW5zZWxlY3RlZCgkZXZlbnQpXCJcbiAgICAgICAgKHAtc2hvdy1tb3JlKT1cInNob3dNb3JlRXZlbnQoKVwiXG4gICAgICAgIChwLXNvcnQtYnkpPVwic29ydEJ5KCRldmVudClcIlxuICAgICAgPlxuICAgICAgPC9wby10YWJsZT5cbiAgICA8L2Rpdj5cblxuICAgIDwhLS0gRElTQ0xBSU1FUiAtLT5cbiAgICA8cG8tZGlzY2xhaW1lci1ncm91cFxuICAgICAgKm5nSWY9XCJtdWx0aXBsZVwiXG4gICAgICBjbGFzcz1cInBvLW1kLTEyXCJcbiAgICAgIFtwLWRpc2NsYWltZXJzXT1cInNlbGVjdGVkc1wiXG4gICAgICAocC1yZW1vdmUpPVwib25VbnNlbGVjdEZyb21EaXNjbGFpbWVyKCRldmVudC5yZW1vdmVkRGlzY2xhaW1lcilcIlxuICAgICAgKHAtcmVtb3ZlLWFsbCk9XCJvbkFsbFVuc2VsZWN0ZWQoJGV2ZW50KVwiXG4gICAgPlxuICAgIDwvcG8tZGlzY2xhaW1lci1ncm91cD5cbiAgPC9kaXY+XG4gIDxkaXYgW2hpZGRlbl09XCIhaXNBZHZhbmNlZEZpbHRlclwiPlxuICAgIDxuZy1jb250YWluZXIgI2NvbnRhaW5lcj4gPC9uZy1jb250YWluZXI+XG4gIDwvZGl2PlxuPC9wby1tb2RhbD5cbiJdfQ==