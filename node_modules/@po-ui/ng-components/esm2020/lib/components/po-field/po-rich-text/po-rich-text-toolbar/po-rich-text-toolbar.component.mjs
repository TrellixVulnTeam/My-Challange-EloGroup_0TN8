import { Component, ElementRef, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { isIE } from '../../../../utils/util';
import { poRichTextLiteralsDefault } from '../po-rich-text-literals';
import { PoRichTextImageModalComponent } from '../po-rich-text-image-modal/po-rich-text-image-modal.component';
import { PoRichTextLinkModalComponent } from '../po-rich-text-link-modal/po-rich-text-link-modal.component';
import * as i0 from "@angular/core";
import * as i1 from "../../../../services/po-language/po-language.service";
import * as i2 from "../../../po-button-group/po-button-group.component";
import * as i3 from "@angular/common";
import * as i4 from "../../../../directives/po-tooltip/po-tooltip.directive";
import * as i5 from "../po-rich-text-image-modal/po-rich-text-image-modal.component";
import * as i6 from "../po-rich-text-link-modal/po-rich-text-link-modal.component";
const _c0 = ["colorPickerInput"];
const _c1 = ["toolbarElement"];
function PoRichTextToolbarComponent_div_4_Template(rf, ctx) { if (rf & 1) {
    const _r6 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "div", 2)(1, "div", 11)(2, "button", 12)(3, "input", 13, 14);
    i0.ɵɵlistener("change", function PoRichTextToolbarComponent_div_4_Template_input_change_3_listener($event) { i0.ɵɵrestoreView(_r6); const ctx_r5 = i0.ɵɵnextContext(); return ctx_r5.changeTextColor($event.target.value); });
    i0.ɵɵelementEnd()()()();
} if (rf & 2) {
    const ctx_r1 = i0.ɵɵnextContext();
    i0.ɵɵadvance(2);
    i0.ɵɵproperty("disabled", ctx_r1.readonly)("p-tooltip", ctx_r1.literals.textColor);
    i0.ɵɵadvance(1);
    i0.ɵɵproperty("disabled", ctx_r1.readonly);
} }
const poRichTextDefaultColor = '#000000';
export class PoRichTextToolbarComponent {
    constructor(languageService) {
        this.languageService = languageService;
        this.command = new EventEmitter();
        this.modal = new EventEmitter();
        this.linkEditing = new EventEmitter();
        this.literals = {
            ...poRichTextLiteralsDefault[this.languageService.getShortLanguage()]
        };
        this.alignButtons = [
            {
                command: 'justifyleft',
                icon: 'po-icon-align-left',
                tooltip: this.literals.left,
                action: this.emitAlignCommand.bind(this, 'justifyleft'),
                selected: true
            },
            {
                command: 'justifycenter',
                icon: 'po-icon-align-center',
                tooltip: this.literals.center,
                action: this.emitAlignCommand.bind(this, 'justifycenter')
            },
            {
                command: 'justifyright',
                icon: 'po-icon-align-right',
                tooltip: this.literals.right,
                action: this.emitAlignCommand.bind(this, 'justifyright')
            },
            {
                command: 'justifyfull',
                icon: 'po-icon-align-justify',
                tooltip: this.literals.justify,
                action: this.emitAlignCommand.bind(this, 'justifyfull')
            }
        ];
        this.formatButtons = [
            {
                command: 'bold',
                icon: 'po-icon-text-bold',
                tooltip: this.literals.bold,
                action: this.emitCommand.bind(this, 'bold')
            },
            {
                command: 'italic',
                icon: 'po-icon-text-italic',
                tooltip: this.literals.italic,
                action: this.emitCommand.bind(this, 'italic')
            },
            {
                command: 'underline',
                icon: 'po-icon-text-underline',
                tooltip: this.literals.underline,
                action: this.emitCommand.bind(this, 'underline')
            }
        ];
        this.listButtons = [
            {
                command: 'insertUnorderedList',
                icon: 'po-icon-list',
                tooltip: this.literals.unorderedList,
                action: this.emitCommand.bind(this, 'insertUnorderedList')
            }
        ];
        this.linkButtons = [
            {
                command: 'Createlink',
                icon: 'po-icon-link',
                tooltip: `${this.literals.insertLink} (Ctrl + K)`,
                action: () => this.richTextLinkModal.openModal(this.selectedLinkElement)
            }
        ];
        this.mediaButtons = [
            {
                tooltip: this.literals.insertImage,
                icon: 'po-icon-picture',
                action: () => this.richTextImageModal.openModal()
            }
        ];
    }
    set readonly(value) {
        this._readonly = value;
        this.toggleDisableButtons(this._readonly);
    }
    get readonly() {
        return this._readonly;
    }
    get isInternetExplorer() {
        return isIE();
    }
    ngAfterViewInit() {
        this.removeButtonFocus();
        this.setColorInColorPicker(poRichTextDefaultColor);
    }
    changeTextColor(value) {
        const command = 'foreColor';
        this.command.emit({ command, value });
    }
    emitLinkEditing(isLinkEdit) {
        this.linkEditing.emit(isLinkEdit);
    }
    selectedLink(selectedLinkElement) {
        this.selectedLinkElement = selectedLinkElement;
    }
    setButtonsStates(obj) {
        if (!this.readonly) {
            this.alignButtons.forEach(button => (button.selected = obj.commands.includes(button.command)));
            this.formatButtons.forEach(button => (button.selected = obj.commands.includes(button.command)));
            this.listButtons[0].selected = obj.commands.includes(this.listButtons[0].command);
            this.linkButtons[0].selected = obj.commands.includes(this.linkButtons[0].command);
            this.setColorInColorPicker(obj.hexColor);
        }
    }
    shortcutTrigger() {
        this.richTextLinkModal.openModal(this.selectedLinkElement);
    }
    emitCommand(command) {
        this.command.emit(command);
    }
    emitAlignCommand(command) {
        const index = this.alignButtons.findIndex(btn => btn.command === command);
        if (this.alignButtons[index].selected) {
            this.alignButtons[index].selected = false;
        }
        this.command.emit(command);
    }
    removeButtonFocus() {
        const buttons = this.toolbarElement.nativeElement.querySelectorAll('button');
        buttons.forEach(button => button.setAttribute('tabindex', '-1'));
    }
    setColorInColorPicker(color) {
        this.colorPickerInput.nativeElement.value = color;
    }
    toggleDisableButtons(state) {
        this.alignButtons.forEach(button => (button.disabled = state));
        this.formatButtons.forEach(button => (button.disabled = state));
        this.listButtons[0].disabled = state;
        this.linkButtons[0].disabled = state;
        this.mediaButtons[0].disabled = state;
    }
}
PoRichTextToolbarComponent.ɵfac = function PoRichTextToolbarComponent_Factory(t) { return new (t || PoRichTextToolbarComponent)(i0.ɵɵdirectiveInject(i1.PoLanguageService)); };
PoRichTextToolbarComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoRichTextToolbarComponent, selectors: [["po-rich-text-toolbar"]], viewQuery: function PoRichTextToolbarComponent_Query(rf, ctx) { if (rf & 1) {
        i0.ɵɵviewQuery(_c0, 5, ElementRef);
        i0.ɵɵviewQuery(_c1, 7);
        i0.ɵɵviewQuery(PoRichTextImageModalComponent, 7);
        i0.ɵɵviewQuery(PoRichTextLinkModalComponent, 7);
    } if (rf & 2) {
        let _t;
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.colorPickerInput = _t.first);
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.toolbarElement = _t.first);
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.richTextImageModal = _t.first);
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.richTextLinkModal = _t.first);
    } }, inputs: { readonly: ["p-readonly", "readonly"] }, outputs: { command: "p-command", modal: "p-modal", linkEditing: "p-link-editing" }, decls: 17, vars: 6, consts: [[1, "po-rich-text-toolbar"], ["toolbarElement", ""], [1, "po-rich-text-toolbar-button-align"], ["p-toggle", "multiple", 3, "p-buttons"], ["class", "po-rich-text-toolbar-button-align", 4, "ngIf"], ["p-toggle", "single", 3, "p-buttons"], [3, "p-buttons"], [3, "p-command"], ["richTextImageModal", ""], [3, "p-command", "p-link-editing"], ["richTextLinkModal", ""], [1, "po-rich-text-toolbar-color-picker-container"], [1, "po-button", "po-text-ellipsis", "po-rich-text-toolbar-color-picker-button", 3, "disabled", "p-tooltip"], ["type", "color", 1, "po-rich-text-toolbar-color-picker-input", 3, "disabled", "change"], ["colorPickerInput", ""]], template: function PoRichTextToolbarComponent_Template(rf, ctx) { if (rf & 1) {
        i0.ɵɵelementStart(0, "div", 0, 1)(2, "div", 2);
        i0.ɵɵelement(3, "po-button-group", 3);
        i0.ɵɵelementEnd();
        i0.ɵɵtemplate(4, PoRichTextToolbarComponent_div_4_Template, 5, 3, "div", 4);
        i0.ɵɵelementStart(5, "div", 2);
        i0.ɵɵelement(6, "po-button-group", 5);
        i0.ɵɵelementEnd();
        i0.ɵɵelementStart(7, "div", 2);
        i0.ɵɵelement(8, "po-button-group", 5);
        i0.ɵɵelementEnd();
        i0.ɵɵelementStart(9, "div", 2);
        i0.ɵɵelement(10, "po-button-group", 6);
        i0.ɵɵelementEnd();
        i0.ɵɵelementStart(11, "div", 2);
        i0.ɵɵelement(12, "po-button-group", 6);
        i0.ɵɵelementEnd()();
        i0.ɵɵelementStart(13, "po-rich-text-image-modal", 7, 8);
        i0.ɵɵlistener("p-command", function PoRichTextToolbarComponent_Template_po_rich_text_image_modal_p_command_13_listener($event) { return ctx.emitCommand($event); });
        i0.ɵɵelementEnd();
        i0.ɵɵelementStart(15, "po-rich-text-link-modal", 9, 10);
        i0.ɵɵlistener("p-command", function PoRichTextToolbarComponent_Template_po_rich_text_link_modal_p_command_15_listener($event) { return ctx.emitCommand($event); })("p-link-editing", function PoRichTextToolbarComponent_Template_po_rich_text_link_modal_p_link_editing_15_listener($event) { return ctx.emitLinkEditing($event); });
        i0.ɵɵelementEnd();
    } if (rf & 2) {
        i0.ɵɵadvance(3);
        i0.ɵɵproperty("p-buttons", ctx.formatButtons);
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngIf", !ctx.isInternetExplorer);
        i0.ɵɵadvance(2);
        i0.ɵɵproperty("p-buttons", ctx.alignButtons);
        i0.ɵɵadvance(2);
        i0.ɵɵproperty("p-buttons", ctx.listButtons);
        i0.ɵɵadvance(2);
        i0.ɵɵproperty("p-buttons", ctx.linkButtons);
        i0.ɵɵadvance(2);
        i0.ɵɵproperty("p-buttons", ctx.mediaButtons);
    } }, directives: [i2.PoButtonGroupComponent, i3.NgIf, i4.PoTooltipDirective, i5.PoRichTextImageModalComponent, i6.PoRichTextLinkModalComponent], encapsulation: 2 });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoRichTextToolbarComponent, [{
        type: Component,
        args: [{ selector: 'po-rich-text-toolbar', template: "<div class=\"po-rich-text-toolbar\" #toolbarElement>\n  <div class=\"po-rich-text-toolbar-button-align\">\n    <po-button-group p-toggle=\"multiple\" [p-buttons]=\"formatButtons\"> </po-button-group>\n  </div>\n\n  <div *ngIf=\"!isInternetExplorer\" class=\"po-rich-text-toolbar-button-align\">\n    <div class=\"po-rich-text-toolbar-color-picker-container\">\n      <button\n        class=\"po-button po-text-ellipsis po-rich-text-toolbar-color-picker-button\"\n        [disabled]=\"readonly\"\n        [p-tooltip]=\"literals.textColor\"\n      >\n        <input\n          #colorPickerInput\n          class=\"po-rich-text-toolbar-color-picker-input\"\n          type=\"color\"\n          [disabled]=\"readonly\"\n          (change)=\"changeTextColor($event.target.value)\"\n        />\n      </button>\n    </div>\n  </div>\n\n  <div class=\"po-rich-text-toolbar-button-align\">\n    <po-button-group p-toggle=\"single\" [p-buttons]=\"alignButtons\"> </po-button-group>\n  </div>\n\n  <div class=\"po-rich-text-toolbar-button-align\">\n    <po-button-group p-toggle=\"single\" [p-buttons]=\"listButtons\"> </po-button-group>\n  </div>\n\n  <div class=\"po-rich-text-toolbar-button-align\">\n    <po-button-group [p-buttons]=\"linkButtons\"> </po-button-group>\n  </div>\n\n  <div class=\"po-rich-text-toolbar-button-align\">\n    <po-button-group [p-buttons]=\"mediaButtons\"> </po-button-group>\n  </div>\n</div>\n\n<po-rich-text-image-modal #richTextImageModal (p-command)=\"emitCommand($event)\"> </po-rich-text-image-modal>\n\n<po-rich-text-link-modal\n  #richTextLinkModal\n  (p-command)=\"emitCommand($event)\"\n  (p-link-editing)=\"emitLinkEditing($event)\"\n>\n</po-rich-text-link-modal>\n" }]
    }], function () { return [{ type: i1.PoLanguageService }]; }, { colorPickerInput: [{
            type: ViewChild,
            args: ['colorPickerInput', { read: ElementRef }]
        }], toolbarElement: [{
            type: ViewChild,
            args: ['toolbarElement', { static: true }]
        }], richTextImageModal: [{
            type: ViewChild,
            args: [PoRichTextImageModalComponent, { static: true }]
        }], richTextLinkModal: [{
            type: ViewChild,
            args: [PoRichTextLinkModalComponent, { static: true }]
        }], command: [{
            type: Output,
            args: ['p-command']
        }], modal: [{
            type: Output,
            args: ['p-modal']
        }], linkEditing: [{
            type: Output,
            args: ['p-link-editing']
        }], readonly: [{
            type: Input,
            args: ['p-readonly']
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tcmljaC10ZXh0LXRvb2xiYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvdWkvc3JjL2xpYi9jb21wb25lbnRzL3BvLWZpZWxkL3BvLXJpY2gtdGV4dC9wby1yaWNoLXRleHQtdG9vbGJhci9wby1yaWNoLXRleHQtdG9vbGJhci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL2NvbXBvbmVudHMvcG8tZmllbGQvcG8tcmljaC10ZXh0L3BvLXJpY2gtdGV4dC10b29sYmFyL3BvLXJpY2gtdGV4dC10b29sYmFyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBaUIsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFN0csT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBSTlDLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRXJFLE9BQU8sRUFBRSw2QkFBNkIsRUFBRSxNQUFNLGdFQUFnRSxDQUFDO0FBQy9HLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLDhEQUE4RCxDQUFDOzs7Ozs7Ozs7Ozs7SUNKMUcsOEJBQTJFLGNBQUEsaUJBQUEsb0JBQUE7SUFZbkUsOEtBQVUsMkNBQW9DLElBQUM7SUFMakQsaUJBTUUsRUFBQSxFQUFBLEVBQUE7OztJQVRGLGVBQXFCO0lBQXJCLDBDQUFxQix3Q0FBQTtJQU9uQixlQUFxQjtJQUFyQiwwQ0FBcUI7O0FETC9CLE1BQU0sc0JBQXNCLEdBQUcsU0FBUyxDQUFDO0FBTXpDLE1BQU0sT0FBTywwQkFBMEI7SUE4R3JDLFlBQW9CLGVBQWtDO1FBQWxDLG9CQUFlLEdBQWYsZUFBZSxDQUFtQjtR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QU07bUJBQUMsV0FBVztZQUVBLEtBQUs7a0JBQXZCLE1BQU07bUJBQUMsU0FBUztZQUVTLFdBQVc7a0JBQXBDLE1BQU07bUJBQUMsZ0JBQWdCO1lBb0ZDLFFBQVE7a0JBQWhDLEtBQUs7bUJBQUMsWUFBWSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyVmlld0luaXQsIENvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT3V0cHV0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgaXNJRSB9IGZyb20gJy4uLy4uLy4uLy4uL3V0aWxzL3V0aWwnO1xuaW1wb3J0IHsgUG9MYW5ndWFnZVNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi8uLi9zZXJ2aWNlcy9wby1sYW5ndWFnZS9wby1sYW5ndWFnZS5zZXJ2aWNlJztcblxuaW1wb3J0IHsgUG9CdXR0b25Hcm91cEl0ZW0gfSBmcm9tICcuLi8uLi8uLi9wby1idXR0b24tZ3JvdXAnO1xuaW1wb3J0IHsgcG9SaWNoVGV4dExpdGVyYWxzRGVmYXVsdCB9IGZyb20gJy4uL3BvLXJpY2gtdGV4dC1saXRlcmFscyc7XG5pbXBvcnQgeyBQb1JpY2hUZXh0VG9vbGJhckJ1dHRvbkdyb3VwSXRlbSB9IGZyb20gJy4uL2ludGVyZmFjZXMvcG8tcmljaC10ZXh0LXRvb2xiYXItYnV0dG9uLWdyb3VwLWl0ZW0uaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvUmljaFRleHRJbWFnZU1vZGFsQ29tcG9uZW50IH0gZnJvbSAnLi4vcG8tcmljaC10ZXh0LWltYWdlLW1vZGFsL3BvLXJpY2gtdGV4dC1pbWFnZS1tb2RhbC5jb21wb25lbnQnO1xuaW1wb3J0IHsgUG9SaWNoVGV4dExpbmtNb2RhbENvbXBvbmVudCB9IGZyb20gJy4uL3BvLXJpY2gtdGV4dC1saW5rLW1vZGFsL3BvLXJpY2gtdGV4dC1saW5rLW1vZGFsLmNvbXBvbmVudCc7XG5cbmNvbnN0IHBvUmljaFRleHREZWZhdWx0Q29sb3IgPSAnIzAwMDAwMCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3BvLXJpY2gtdGV4dC10b29sYmFyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BvLXJpY2gtdGV4dC10b29sYmFyLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBQb1JpY2hUZXh0VG9vbGJhckNvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQge1xuICBAVmlld0NoaWxkKCdjb2xvclBpY2tlcklucHV0JywgeyByZWFkOiBFbGVtZW50UmVmIH0pIGNvbG9yUGlja2VySW5wdXQ6IEVsZW1lbnRSZWY7XG5cbiAgQFZpZXdDaGlsZCgndG9vbGJhckVsZW1lbnQnLCB7IHN0YXRpYzogdHJ1ZSB9KSB0b29sYmFyRWxlbWVudDogRWxlbWVudFJlZjtcblxuICBAVmlld0NoaWxkKFBvUmljaFRleHRJbWFnZU1vZGFsQ29tcG9uZW50LCB7IHN0YXRpYzogdHJ1ZSB9KSByaWNoVGV4dEltYWdlTW9kYWw6IFBvUmljaFRleHRJbWFnZU1vZGFsQ29tcG9uZW50O1xuXG4gIEBWaWV3Q2hpbGQoUG9SaWNoVGV4dExpbmtNb2RhbENvbXBvbmVudCwgeyBzdGF0aWM6IHRydWUgfSkgcmljaFRleHRMaW5rTW9kYWw6IFBvUmljaFRleHRMaW5rTW9kYWxDb21wb25lbnQ7XG5cbiAgQE91dHB1dCgncC1jb21tYW5kJykgY29tbWFuZCA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nIHwgeyBjb21tYW5kOiBzdHJpbmc7IHZhbHVlOiBzdHJpbmcgfT4oKTtcblxuICBAT3V0cHV0KCdwLW1vZGFsJykgbW9kYWwgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBAT3V0cHV0KCdwLWxpbmstZWRpdGluZycpIGxpbmtFZGl0aW5nID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgcmVhZG9ubHkgbGl0ZXJhbHMgPSB7XG4gICAgLi4ucG9SaWNoVGV4dExpdGVyYWxzRGVmYXVsdFt0aGlzLmxhbmd1YWdlU2VydmljZS5nZXRTaG9ydExhbmd1YWdlKCldXG4gIH07XG5cbiAgYWxpZ25CdXR0b25zOiBBcnJheTxQb1JpY2hUZXh0VG9vbGJhckJ1dHRvbkdyb3VwSXRlbT4gPSBbXG4gICAge1xuICAgICAgY29tbWFuZDogJ2p1c3RpZnlsZWZ0JyxcbiAgICAgIGljb246ICdwby1pY29uLWFsaWduLWxlZnQnLFxuICAgICAgdG9vbHRpcDogdGhpcy5saXRlcmFscy5sZWZ0LFxuICAgICAgYWN0aW9uOiB0aGlzLmVtaXRBbGlnbkNvbW1hbmQuYmluZCh0aGlzLCAnanVzdGlmeWxlZnQnKSxcbiAgICAgIHNlbGVjdGVkOiB0cnVlXG4gICAgfSxcbiAgICB7XG4gICAgICBjb21tYW5kOiAnanVzdGlmeWNlbnRlcicsXG4gICAgICBpY29uOiAncG8taWNvbi1hbGlnbi1jZW50ZXInLFxuICAgICAgdG9vbHRpcDogdGhpcy5saXRlcmFscy5jZW50ZXIsXG4gICAgICBhY3Rpb246IHRoaXMuZW1pdEFsaWduQ29tbWFuZC5iaW5kKHRoaXMsICdqdXN0aWZ5Y2VudGVyJylcbiAgICB9LFxuICAgIHtcbiAgICAgIGNvbW1hbmQ6ICdqdXN0aWZ5cmlnaHQnLFxuICAgICAgaWNvbjogJ3BvLWljb24tYWxpZ24tcmlnaHQnLFxuICAgICAgdG9vbHRpcDogdGhpcy5saXRlcmFscy5yaWdodCxcbiAgICAgIGFjdGlvbjogdGhpcy5lbWl0QWxpZ25Db21tYW5kLmJpbmQodGhpcywgJ2p1c3RpZnlyaWdodCcpXG4gICAgfSxcbiAgICB7XG4gICAgICBjb21tYW5kOiAnanVzdGlmeWZ1bGwnLFxuICAgICAgaWNvbjogJ3BvLWljb24tYWxpZ24tanVzdGlmeScsXG4gICAgICB0b29sdGlwOiB0aGlzLmxpdGVyYWxzLmp1c3RpZnksXG4gICAgICBhY3Rpb246IHRoaXMuZW1pdEFsaWduQ29tbWFuZC5iaW5kKHRoaXMsICdqdXN0aWZ5ZnVsbCcpXG4gICAgfVxuICBdO1xuXG4gIGZvcm1hdEJ1dHRvbnM6IEFycmF5PFBvUmljaFRleHRUb29sYmFyQnV0dG9uR3JvdXBJdGVtPiA9IFtcbiAgICB7XG4gICAgICBjb21tYW5kOiAnYm9sZCcsXG4gICAgICBpY29uOiAncG8taWNvbi10ZXh0LWJvbGQnLFxuICAgICAgdG9vbHRpcDogdGhpcy5saXRlcmFscy5ib2xkLFxuICAgICAgYWN0aW9uOiB0aGlzLmVtaXRDb21tYW5kLmJpbmQodGhpcywgJ2JvbGQnKVxuICAgIH0sXG4gICAge1xuICAgICAgY29tbWFuZDogJ2l0YWxpYycsXG4gICAgICBpY29uOiAncG8taWNvbi10ZXh0LWl0YWxpYycsXG4gICAgICB0b29sdGlwOiB0aGlzLmxpdGVyYWxzLml0YWxpYyxcbiAgICAgIGFjdGlvbjogdGhpcy5lbWl0Q29tbWFuZC5iaW5kKHRoaXMsICdpdGFsaWMnKVxuICAgIH0sXG4gICAge1xuICAgICAgY29tbWFuZDogJ3VuZGVybGluZScsXG4gICAgICBpY29uOiAncG8taWNvbi10ZXh0LXVuZGVybGluZScsXG4gICAgICB0b29sdGlwOiB0aGlzLmxpdGVyYWxzLnVuZGVybGluZSxcbiAgICAgIGFjdGlvbjogdGhpcy5lbWl0Q29tbWFuZC5iaW5kKHRoaXMsICd1bmRlcmxpbmUnKVxuICAgIH1cbiAgXTtcblxuICBsaXN0QnV0dG9uczogQXJyYXk8UG9SaWNoVGV4dFRvb2xiYXJCdXR0b25Hcm91cEl0ZW0+ID0gW1xuICAgIHtcbiAgICAgIGNvbW1hbmQ6ICdpbnNlcnRVbm9yZGVyZWRMaXN0JyxcbiAgICAgIGljb246ICdwby1pY29uLWxpc3QnLFxuICAgICAgdG9vbHRpcDogdGhpcy5saXRlcmFscy51bm9yZGVyZWRMaXN0LFxuICAgICAgYWN0aW9uOiB0aGlzLmVtaXRDb21tYW5kLmJpbmQodGhpcywgJ2luc2VydFVub3JkZXJlZExpc3QnKVxuICAgIH1cbiAgXTtcblxuICBsaW5rQnV0dG9uczogQXJyYXk8UG9SaWNoVGV4dFRvb2xiYXJCdXR0b25Hcm91cEl0ZW0+ID0gW1xuICAgIHtcbiAgICAgIGNvbW1hbmQ6ICdDcmVhdGVsaW5rJyxcbiAgICAgIGljb246ICdwby1pY29uLWxpbmsnLFxuICAgICAgdG9vbHRpcDogYCR7dGhpcy5saXRlcmFscy5pbnNlcnRMaW5rfSAoQ3RybCArIEspYCxcbiAgICAgIGFjdGlvbjogKCkgPT4gdGhpcy5yaWNoVGV4dExpbmtNb2RhbC5vcGVuTW9kYWwodGhpcy5zZWxlY3RlZExpbmtFbGVtZW50KVxuICAgIH1cbiAgXTtcblxuICBtZWRpYUJ1dHRvbnM6IEFycmF5PFBvQnV0dG9uR3JvdXBJdGVtPiA9IFtcbiAgICB7XG4gICAgICB0b29sdGlwOiB0aGlzLmxpdGVyYWxzLmluc2VydEltYWdlLFxuICAgICAgaWNvbjogJ3BvLWljb24tcGljdHVyZScsXG4gICAgICBhY3Rpb246ICgpID0+IHRoaXMucmljaFRleHRJbWFnZU1vZGFsLm9wZW5Nb2RhbCgpXG4gICAgfVxuICBdO1xuXG4gIHByaXZhdGUgX3JlYWRvbmx5OiBib29sZWFuO1xuICBwcml2YXRlIHNlbGVjdGVkTGlua0VsZW1lbnQ7XG5cbiAgQElucHV0KCdwLXJlYWRvbmx5Jykgc2V0IHJlYWRvbmx5KHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5fcmVhZG9ubHkgPSB2YWx1ZTtcbiAgICB0aGlzLnRvZ2dsZURpc2FibGVCdXR0b25zKHRoaXMuX3JlYWRvbmx5KTtcbiAgfVxuXG4gIGdldCByZWFkb25seSgpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVhZG9ubHk7XG4gIH1cblxuICBnZXQgaXNJbnRlcm5ldEV4cGxvcmVyKCkge1xuICAgIHJldHVybiBpc0lFKCk7XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGxhbmd1YWdlU2VydmljZTogUG9MYW5ndWFnZVNlcnZpY2UpIHt9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMucmVtb3ZlQnV0dG9uRm9jdXMoKTtcbiAgICB0aGlzLnNldENvbG9ySW5Db2xvclBpY2tlcihwb1JpY2hUZXh0RGVmYXVsdENvbG9yKTtcbiAgfVxuXG4gIGNoYW5nZVRleHRDb2xvcih2YWx1ZSkge1xuICAgIGNvbnN0IGNvbW1hbmQgPSAnZm9yZUNvbG9yJztcblxuICAgIHRoaXMuY29tbWFuZC5lbWl0KHsgY29tbWFuZCwgdmFsdWUgfSk7XG4gIH1cblxuICBlbWl0TGlua0VkaXRpbmcoaXNMaW5rRWRpdDogYm9vbGVhbikge1xuICAgIHRoaXMubGlua0VkaXRpbmcuZW1pdChpc0xpbmtFZGl0KTtcbiAgfVxuXG4gIHNlbGVjdGVkTGluayhzZWxlY3RlZExpbmtFbGVtZW50KSB7XG4gICAgdGhpcy5zZWxlY3RlZExpbmtFbGVtZW50ID0gc2VsZWN0ZWRMaW5rRWxlbWVudDtcbiAgfVxuXG4gIHNldEJ1dHRvbnNTdGF0ZXMob2JqOiB7IGNvbW1hbmRzOiBBcnJheTxzdHJpbmc+OyBoZXhDb2xvcjogc3RyaW5nIH0pIHtcbiAgICBpZiAoIXRoaXMucmVhZG9ubHkpIHtcbiAgICAgIHRoaXMuYWxpZ25CdXR0b25zLmZvckVhY2goYnV0dG9uID0+IChidXR0b24uc2VsZWN0ZWQgPSBvYmouY29tbWFuZHMuaW5jbHVkZXMoYnV0dG9uLmNvbW1hbmQpKSk7XG4gICAgICB0aGlzLmZvcm1hdEJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gKGJ1dHRvbi5zZWxlY3RlZCA9IG9iai5jb21tYW5kcy5pbmNsdWRlcyhidXR0b24uY29tbWFuZCkpKTtcbiAgICAgIHRoaXMubGlzdEJ1dHRvbnNbMF0uc2VsZWN0ZWQgPSBvYmouY29tbWFuZHMuaW5jbHVkZXModGhpcy5saXN0QnV0dG9uc1swXS5jb21tYW5kKTtcbiAgICAgIHRoaXMubGlua0J1dHRvbnNbMF0uc2VsZWN0ZWQgPSBvYmouY29tbWFuZHMuaW5jbHVkZXModGhpcy5saW5rQnV0dG9uc1swXS5jb21tYW5kKTtcbiAgICAgIHRoaXMuc2V0Q29sb3JJbkNvbG9yUGlja2VyKG9iai5oZXhDb2xvcik7XG4gICAgfVxuICB9XG5cbiAgc2hvcnRjdXRUcmlnZ2VyKCkge1xuICAgIHRoaXMucmljaFRleHRMaW5rTW9kYWwub3Blbk1vZGFsKHRoaXMuc2VsZWN0ZWRMaW5rRWxlbWVudCk7XG4gIH1cblxuICBlbWl0Q29tbWFuZChjb21tYW5kOiBzdHJpbmcpIHtcbiAgICB0aGlzLmNvbW1hbmQuZW1pdChjb21tYW5kKTtcbiAgfVxuXG4gIHByaXZhdGUgZW1pdEFsaWduQ29tbWFuZChjb21tYW5kOiBzdHJpbmcpIHtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuYWxpZ25CdXR0b25zLmZpbmRJbmRleChidG4gPT4gYnRuLmNvbW1hbmQgPT09IGNvbW1hbmQpO1xuXG4gICAgaWYgKHRoaXMuYWxpZ25CdXR0b25zW2luZGV4XS5zZWxlY3RlZCkge1xuICAgICAgdGhpcy5hbGlnbkJ1dHRvbnNbaW5kZXhdLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdGhpcy5jb21tYW5kLmVtaXQoY29tbWFuZCk7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZUJ1dHRvbkZvY3VzKCkge1xuICAgIGNvbnN0IGJ1dHRvbnMgPSB0aGlzLnRvb2xiYXJFbGVtZW50Lm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnYnV0dG9uJyk7XG5cbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJy0xJykpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRDb2xvckluQ29sb3JQaWNrZXIoY29sb3I6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuY29sb3JQaWNrZXJJbnB1dC5uYXRpdmVFbGVtZW50LnZhbHVlID0gY29sb3I7XG4gIH1cblxuICBwcml2YXRlIHRvZ2dsZURpc2FibGVCdXR0b25zKHN0YXRlOiBib29sZWFuKSB7XG4gICAgdGhpcy5hbGlnbkJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gKGJ1dHRvbi5kaXNhYmxlZCA9IHN0YXRlKSk7XG4gICAgdGhpcy5mb3JtYXRCdXR0b25zLmZvckVhY2goYnV0dG9uID0+IChidXR0b24uZGlzYWJsZWQgPSBzdGF0ZSkpO1xuICAgIHRoaXMubGlzdEJ1dHRvbnNbMF0uZGlzYWJsZWQgPSBzdGF0ZTtcbiAgICB0aGlzLmxpbmtCdXR0b25zWzBdLmRpc2FibGVkID0gc3RhdGU7XG4gICAgdGhpcy5tZWRpYUJ1dHRvbnNbMF0uZGlzYWJsZWQgPSBzdGF0ZTtcbiAgfVxufVxuIiwiPGRpdiBjbGFzcz1cInBvLXJpY2gtdGV4dC10b29sYmFyXCIgI3Rvb2xiYXJFbGVtZW50PlxuICA8ZGl2IGNsYXNzPVwicG8tcmljaC10ZXh0LXRvb2xiYXItYnV0dG9uLWFsaWduXCI+XG4gICAgPHBvLWJ1dHRvbi1ncm91cCBwLXRvZ2dsZT1cIm11bHRpcGxlXCIgW3AtYnV0dG9uc109XCJmb3JtYXRCdXR0b25zXCI+IDwvcG8tYnV0dG9uLWdyb3VwPlxuICA8L2Rpdj5cblxuICA8ZGl2ICpuZ0lmPVwiIWlzSW50ZXJuZXRFeHBsb3JlclwiIGNsYXNzPVwicG8tcmljaC10ZXh0LXRvb2xiYXItYnV0dG9uLWFsaWduXCI+XG4gICAgPGRpdiBjbGFzcz1cInBvLXJpY2gtdGV4dC10b29sYmFyLWNvbG9yLXBpY2tlci1jb250YWluZXJcIj5cbiAgICAgIDxidXR0b25cbiAgICAgICAgY2xhc3M9XCJwby1idXR0b24gcG8tdGV4dC1lbGxpcHNpcyBwby1yaWNoLXRleHQtdG9vbGJhci1jb2xvci1waWNrZXItYnV0dG9uXCJcbiAgICAgICAgW2Rpc2FibGVkXT1cInJlYWRvbmx5XCJcbiAgICAgICAgW3AtdG9vbHRpcF09XCJsaXRlcmFscy50ZXh0Q29sb3JcIlxuICAgICAgPlxuICAgICAgICA8aW5wdXRcbiAgICAgICAgICAjY29sb3JQaWNrZXJJbnB1dFxuICAgICAgICAgIGNsYXNzPVwicG8tcmljaC10ZXh0LXRvb2xiYXItY29sb3ItcGlja2VyLWlucHV0XCJcbiAgICAgICAgICB0eXBlPVwiY29sb3JcIlxuICAgICAgICAgIFtkaXNhYmxlZF09XCJyZWFkb25seVwiXG4gICAgICAgICAgKGNoYW5nZSk9XCJjaGFuZ2VUZXh0Q29sb3IoJGV2ZW50LnRhcmdldC52YWx1ZSlcIlxuICAgICAgICAvPlxuICAgICAgPC9idXR0b24+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuXG4gIDxkaXYgY2xhc3M9XCJwby1yaWNoLXRleHQtdG9vbGJhci1idXR0b24tYWxpZ25cIj5cbiAgICA8cG8tYnV0dG9uLWdyb3VwIHAtdG9nZ2xlPVwic2luZ2xlXCIgW3AtYnV0dG9uc109XCJhbGlnbkJ1dHRvbnNcIj4gPC9wby1idXR0b24tZ3JvdXA+XG4gIDwvZGl2PlxuXG4gIDxkaXYgY2xhc3M9XCJwby1yaWNoLXRleHQtdG9vbGJhci1idXR0b24tYWxpZ25cIj5cbiAgICA8cG8tYnV0dG9uLWdyb3VwIHAtdG9nZ2xlPVwic2luZ2xlXCIgW3AtYnV0dG9uc109XCJsaXN0QnV0dG9uc1wiPiA8L3BvLWJ1dHRvbi1ncm91cD5cbiAgPC9kaXY+XG5cbiAgPGRpdiBjbGFzcz1cInBvLXJpY2gtdGV4dC10b29sYmFyLWJ1dHRvbi1hbGlnblwiPlxuICAgIDxwby1idXR0b24tZ3JvdXAgW3AtYnV0dG9uc109XCJsaW5rQnV0dG9uc1wiPiA8L3BvLWJ1dHRvbi1ncm91cD5cbiAgPC9kaXY+XG5cbiAgPGRpdiBjbGFzcz1cInBvLXJpY2gtdGV4dC10b29sYmFyLWJ1dHRvbi1hbGlnblwiPlxuICAgIDxwby1idXR0b24tZ3JvdXAgW3AtYnV0dG9uc109XCJtZWRpYUJ1dHRvbnNcIj4gPC9wby1idXR0b24tZ3JvdXA+XG4gIDwvZGl2PlxuPC9kaXY+XG5cbjxwby1yaWNoLXRleHQtaW1hZ2UtbW9kYWwgI3JpY2hUZXh0SW1hZ2VNb2RhbCAocC1jb21tYW5kKT1cImVtaXRDb21tYW5kKCRldmVudClcIj4gPC9wby1yaWNoLXRleHQtaW1hZ2UtbW9kYWw+XG5cbjxwby1yaWNoLXRleHQtbGluay1tb2RhbFxuICAjcmljaFRleHRMaW5rTW9kYWxcbiAgKHAtY29tbWFuZCk9XCJlbWl0Q29tbWFuZCgkZXZlbnQpXCJcbiAgKHAtbGluay1lZGl0aW5nKT1cImVtaXRMaW5rRWRpdGluZygkZXZlbnQpXCJcbj5cbjwvcG8tcmljaC10ZXh0LWxpbmstbW9kYWw+XG4iXX0=