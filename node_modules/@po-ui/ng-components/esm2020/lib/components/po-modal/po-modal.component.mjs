import { Component, ContentChild, ElementRef, ViewChild } from '@angular/core';
import { PoModalBaseComponent } from './po-modal-base.component';
import { PoModalFooterComponent } from './po-modal-footer/po-modal-footer.component';
import { uuid } from '../../utils/util';
import * as i0 from "@angular/core";
import * as i1 from "../../services/po-active-overlay/po-active-overlay.service";
import * as i2 from "../../services/po-language/po-language.service";
import * as i3 from "@angular/common";
import * as i4 from "./po-modal-footer/po-modal-footer.component";
import * as i5 from "../po-button/po-button.component";
const _c0 = ["modalContent"];
function PoModalComponent_div_0_a_9_Template(rf, ctx) { if (rf & 1) {
    const _r7 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "a", 13);
    i0.ɵɵlistener("click", function PoModalComponent_div_0_a_9_Template_a_click_0_listener() { i0.ɵɵrestoreView(_r7); const ctx_r6 = i0.ɵɵnextContext(2); return ctx_r6.close(true); });
    i0.ɵɵelement(1, "span", 14);
    i0.ɵɵelementEnd();
} }
function PoModalComponent_div_0_ng_container_12_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementContainerStart(0);
    i0.ɵɵprojection(1, 1);
    i0.ɵɵelementContainerEnd();
} }
function PoModalComponent_div_0_ng_template_13_po_button_1_Template(rf, ctx) { if (rf & 1) {
    const _r10 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "po-button", 17);
    i0.ɵɵlistener("p-click", function PoModalComponent_div_0_ng_template_13_po_button_1_Template_po_button_p_click_0_listener() { i0.ɵɵrestoreView(_r10); const ctx_r9 = i0.ɵɵnextContext(3); return ctx_r9.secondaryAction.action(); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r8 = i0.ɵɵnextContext(3);
    i0.ɵɵproperty("p-disabled", ctx_r8.secondaryAction.disabled)("p-label", ctx_r8.secondaryAction.label)("p-loading", ctx_r8.secondaryAction.loading)("p-type", ctx_r8.getSecondaryActionButtonType());
} }
function PoModalComponent_div_0_ng_template_13_Template(rf, ctx) { if (rf & 1) {
    const _r12 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "po-modal-footer");
    i0.ɵɵtemplate(1, PoModalComponent_div_0_ng_template_13_po_button_1_Template, 1, 4, "po-button", 15);
    i0.ɵɵelementStart(2, "po-button", 16);
    i0.ɵɵlistener("p-click", function PoModalComponent_div_0_ng_template_13_Template_po_button_p_click_2_listener() { i0.ɵɵrestoreView(_r12); const ctx_r11 = i0.ɵɵnextContext(2); return ctx_r11.primaryAction.action(); });
    i0.ɵɵelementEnd()();
} if (rf & 2) {
    const ctx_r5 = i0.ɵɵnextContext(2);
    i0.ɵɵadvance(1);
    i0.ɵɵproperty("ngIf", ctx_r5.secondaryAction);
    i0.ɵɵadvance(1);
    i0.ɵɵproperty("p-disabled", ctx_r5.primaryAction.disabled)("p-label", ctx_r5.primaryAction.label)("p-loading", ctx_r5.primaryAction.loading)("p-type", ctx_r5.getPrimaryActionButtonType());
} }
function PoModalComponent_div_0_Template(rf, ctx) { if (rf & 1) {
    const _r14 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "div", 1);
    i0.ɵɵlistener("keydown.esc", function PoModalComponent_div_0_Template_div_keydown_esc_0_listener($event) { i0.ɵɵrestoreView(_r14); const ctx_r13 = i0.ɵɵnextContext(); return ctx_r13.closeModalOnEscapeKey($event); });
    i0.ɵɵelementStart(1, "div", 2)(2, "div", 3);
    i0.ɵɵlistener("mousedown", function PoModalComponent_div_0_Template_div_mousedown_2_listener($event) { i0.ɵɵrestoreView(_r14); const ctx_r15 = i0.ɵɵnextContext(); return ctx_r15.onClickOut($event); });
    i0.ɵɵelementStart(3, "div", 4)(4, "div", 5, 6)(6, "div", 7)(7, "div", 8);
    i0.ɵɵtext(8);
    i0.ɵɵelementEnd();
    i0.ɵɵtemplate(9, PoModalComponent_div_0_a_9_Template, 2, 0, "a", 9);
    i0.ɵɵelementEnd();
    i0.ɵɵelementStart(10, "div", 10);
    i0.ɵɵprojection(11);
    i0.ɵɵelementEnd();
    i0.ɵɵtemplate(12, PoModalComponent_div_0_ng_container_12_Template, 2, 0, "ng-container", 11);
    i0.ɵɵtemplate(13, PoModalComponent_div_0_ng_template_13_Template, 3, 5, "ng-template", null, 12, i0.ɵɵtemplateRefExtractor);
    i0.ɵɵelementEnd()()()()();
} if (rf & 2) {
    const _r4 = i0.ɵɵreference(14);
    const ctx_r0 = i0.ɵɵnextContext();
    i0.ɵɵadvance(4);
    i0.ɵɵclassMapInterpolate1("po-modal-content po-modal-", ctx_r0.size, "");
    i0.ɵɵadvance(4);
    i0.ɵɵtextInterpolate1(" ", ctx_r0.title, " ");
    i0.ɵɵadvance(1);
    i0.ɵɵproperty("ngIf", !ctx_r0.hideClose);
    i0.ɵɵadvance(3);
    i0.ɵɵproperty("ngIf", ctx_r0.modalFooter)("ngIfElse", _r4);
} }
const _c1 = ["*", [["po-modal-footer"]]];
const _c2 = ["*", "po-modal-footer"];
/**
 * @docsExtends PoModalBaseComponent
 *
 * @example
 *
 * <example name="po-modal-basic" title="PO Modal Basic">
 *  <file name="sample-po-modal-basic/sample-po-modal-basic.component.html"> </file>
 *  <file name="sample-po-modal-basic/sample-po-modal-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-modal-labs" title="PO Modal Labs">
 *  <file name="sample-po-modal-labs/sample-po-modal-labs.component.html"> </file>
 *  <file name="sample-po-modal-labs/sample-po-modal-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-modal-fruits-salad" title="PO Modal - Fruits Salad">
 *  <file name="sample-po-modal-fruits-salad/sample-po-modal-fruits-salad.component.html"> </file>
 *  <file name="sample-po-modal-fruits-salad/sample-po-modal-fruits-salad.component.ts"> </file>
 * </example>
 */
export class PoModalComponent extends PoModalBaseComponent {
    constructor(poActiveOverlayService, poLanguageService) {
        super(poLanguageService);
        this.poActiveOverlayService = poActiveOverlayService;
        this.focusableElements = 'input, select, textarea, button:not([disabled]), a';
        this.id = uuid();
    }
    close(xClosed = false) {
        this.poActiveOverlayService.activeOverlay.pop();
        super.close(xClosed);
        this.removeEventListeners();
        if (this.sourceElement) {
            this.sourceElement.focus();
        }
    }
    closeModalOnEscapeKey(event) {
        if (!this.hideClose) {
            event.preventDefault();
            event.stopPropagation();
            this.close();
        }
    }
    getPrimaryActionButtonType() {
        return this.primaryAction.danger ? 'danger' : 'primary';
    }
    getSecondaryActionButtonType() {
        return this.secondaryAction && this.secondaryAction.danger && !this.primaryAction.danger ? 'danger' : 'default';
    }
    onClickOut(event) {
        if (this.clickOut && !this.modalContent.nativeElement.contains(event.target)) {
            this.close();
        }
    }
    open() {
        this.sourceElement = document.activeElement;
        super.open();
        this.handleFocus();
    }
    handleFocus() {
        this.poActiveOverlayService.activeOverlay.push(this.id);
        setTimeout(() => {
            if (this.modalContent) {
                this.initFocus();
                document.addEventListener('focus', this.focusFunction, true);
            }
        });
    }
    initFocus() {
        this.focusFunction = (event) => {
            const modalElement = this.modalContent.nativeElement;
            if (!modalElement.contains(event.target) &&
                this.poActiveOverlayService.activeOverlay[this.poActiveOverlayService.activeOverlay.length - 1] === this.id) {
                event.stopPropagation();
                this.firstElement.focus();
            }
        };
        this.setFirstElement();
        if (this.hideClose) {
            this.firstElement.focus();
        }
        else {
            const firstFieldElement = this.modalContent.nativeElement.querySelectorAll(this.focusableElements)[1] || this.modalContent.nativeElement;
            firstFieldElement.focus();
        }
    }
    removeEventListeners() {
        document.removeEventListener('focus', this.focusFunction, true);
    }
    setFirstElement() {
        this.firstElement =
            this.modalContent.nativeElement.querySelector(this.focusableElements) || this.modalContent.nativeElement;
    }
}
PoModalComponent.ɵfac = function PoModalComponent_Factory(t) { return new (t || PoModalComponent)(i0.ɵɵdirectiveInject(i1.PoActiveOverlayService), i0.ɵɵdirectiveInject(i2.PoLanguageService)); };
PoModalComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoModalComponent, selectors: [["po-modal"]], contentQueries: function PoModalComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        i0.ɵɵcontentQuery(dirIndex, PoModalFooterComponent, 5);
    } if (rf & 2) {
        let _t;
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.modalFooter = _t.first);
    } }, viewQuery: function PoModalComponent_Query(rf, ctx) { if (rf & 1) {
        i0.ɵɵviewQuery(_c0, 5, ElementRef);
    } if (rf & 2) {
        let _t;
        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.modalContent = _t.first);
    } }, features: [i0.ɵɵInheritDefinitionFeature], ngContentSelectors: _c2, decls: 1, vars: 1, consts: [["class", "po-modal", "tabindex", "0", 3, "keydown.esc", 4, "ngIf"], ["tabindex", "0", 1, "po-modal", 3, "keydown.esc"], [1, "po-modal-overlay"], [1, "po-modal-container", "po-pb-2", "po-pt-2", 3, "mousedown"], [1, "po-modal-vertical-align"], ["tabindex", "-1"], ["modalContent", ""], [1, "po-modal-header"], [1, "po-modal-title", "po-text-ellipsis"], ["class", "po-modal-header-close-button", "tabindex", "0", 3, "click", 4, "ngIf"], [1, "po-modal-body"], [4, "ngIf", "ngIfElse"], ["defaultModalFooterTemplate", ""], ["tabindex", "0", 1, "po-modal-header-close-button", 3, "click"], [1, "po-icon", "po-icon-close"], [3, "p-disabled", "p-label", "p-loading", "p-type", "p-click", 4, "ngIf"], [1, "po-button-modal-first-action", 3, "p-disabled", "p-label", "p-loading", "p-type", "p-click"], [3, "p-disabled", "p-label", "p-loading", "p-type", "p-click"]], template: function PoModalComponent_Template(rf, ctx) { if (rf & 1) {
        i0.ɵɵprojectionDef(_c1);
        i0.ɵɵtemplate(0, PoModalComponent_div_0_Template, 15, 7, "div", 0);
    } if (rf & 2) {
        i0.ɵɵproperty("ngIf", !ctx.isHidden);
    } }, directives: [i3.NgIf, i4.PoModalFooterComponent, i5.PoButtonComponent], encapsulation: 2 });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoModalComponent, [{
        type: Component,
        args: [{ selector: 'po-modal', template: "<div *ngIf=\"!isHidden\" class=\"po-modal\" tabindex=\"0\" (keydown.esc)=\"closeModalOnEscapeKey($event)\">\n  <div class=\"po-modal-overlay\">\n    <div class=\"po-modal-container po-pb-2 po-pt-2\" (mousedown)=\"onClickOut($event)\">\n      <div class=\"po-modal-vertical-align\">\n        <div #modalContent class=\"po-modal-content po-modal-{{ size }}\" tabindex=\"-1\">\n          <div class=\"po-modal-header\">\n            <div class=\"po-modal-title po-text-ellipsis\">\n              {{ title }}\n            </div>\n\n            <a *ngIf=\"!hideClose\" class=\"po-modal-header-close-button\" tabindex=\"0\" (click)=\"close(true)\">\n              <span class=\"po-icon po-icon-close\"></span>\n            </a>\n          </div>\n\n          <div class=\"po-modal-body\">\n            <ng-content></ng-content>\n          </div>\n\n          <ng-container *ngIf=\"modalFooter; else defaultModalFooterTemplate\">\n            <ng-content select=\"po-modal-footer\"></ng-content>\n          </ng-container>\n\n          <ng-template #defaultModalFooterTemplate>\n            <po-modal-footer>\n              <po-button\n                *ngIf=\"secondaryAction\"\n                [p-disabled]=\"secondaryAction.disabled\"\n                [p-label]=\"secondaryAction.label\"\n                [p-loading]=\"secondaryAction.loading\"\n                [p-type]=\"getSecondaryActionButtonType()\"\n                (p-click)=\"secondaryAction.action()\"\n              >\n              </po-button>\n\n              <po-button\n                class=\"po-button-modal-first-action\"\n                [p-disabled]=\"primaryAction.disabled\"\n                [p-label]=\"primaryAction.label\"\n                [p-loading]=\"primaryAction.loading\"\n                [p-type]=\"getPrimaryActionButtonType()\"\n                (p-click)=\"primaryAction.action()\"\n              >\n              </po-button>\n            </po-modal-footer>\n          </ng-template>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n" }]
    }], function () { return [{ type: i1.PoActiveOverlayService }, { type: i2.PoLanguageService }]; }, { modalContent: [{
            type: ViewChild,
            args: ['modalContent', { read: ElementRef }]
        }], modalFooter: [{
            type: ContentChild,
            args: [PoModalFooterComponent]
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tbW9kYWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvdWkvc3JjL2xpYi9jb21wb25lbnRzL3BvLW1vZGFsL3BvLW1vZGFsLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1tb2RhbC9wby1tb2RhbC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRS9FLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDZDQUE2QyxDQUFDO0FBQ3JGLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQzs7Ozs7Ozs7OztJQ001Qiw2QkFBOEY7SUFBdEIsNkpBQVMsYUFBTSxJQUFJLENBQUMsSUFBQztJQUMzRiwyQkFBMkM7SUFDN0MsaUJBQUk7OztJQU9OLDZCQUFtRTtJQUNqRSxxQkFBa0Q7SUFDcEQsMEJBQWU7Ozs7SUFJWCxxQ0FPQztJQURDLGlNQUFXLCtCQUF3QixJQUFDO0lBRXRDLGlCQUFZOzs7SUFOViw0REFBdUMseUNBQUEsNkNBQUEsaURBQUE7Ozs7SUFIM0MsdUNBQWlCO0lBQ2YsbUdBUVk7SUFFWixxQ0FPQztJQURDLHNMQUFXLDhCQUFzQixJQUFDO0lBRXBDLGlCQUFZLEVBQUE7OztJQWpCVCxlQUFxQjtJQUFyQiw2Q0FBcUI7SUFXdEIsZUFBcUM7SUFBckMsMERBQXFDLHVDQUFBLDJDQUFBLCtDQUFBOzs7O0lBckNyRCw4QkFBbUc7SUFBOUMsOEtBQWUscUNBQTZCLElBQUM7SUFDaEcsOEJBQThCLGFBQUE7SUFDb0IsMEtBQWEsMEJBQWtCLElBQUM7SUFDOUUs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Ozs7K0JBREQsVUFBVTs7Ozs7O1FDbkMvQyxrRUFrRE07O1FBbERBLG9DQUFlOzt1RkRrQ1IsZ0JBQWdCO2NBSjVCLFNBQVM7MkJBQ0UsVUFBVTt5R0FJNkIsWUFBWTtrQkFBNUQsU0FBUzttQkFBQyxjQUFjLEVBQUUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFO1lBQ1QsV0FBVztrQkFBaEQsWUFBWTttQkFBQyxzQkFBc0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIENvbnRlbnRDaGlsZCwgRWxlbWVudFJlZiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFBvTW9kYWxCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi9wby1tb2RhbC1iYXNlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb01vZGFsRm9vdGVyQ29tcG9uZW50IH0gZnJvbSAnLi9wby1tb2RhbC1mb290ZXIvcG8tbW9kYWwtZm9vdGVyLmNvbXBvbmVudCc7XG5pbXBvcnQgeyB1dWlkIH0gZnJvbSAnLi4vLi4vdXRpbHMvdXRpbCc7XG5cbmltcG9ydCB7IFBvQWN0aXZlT3ZlcmxheVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9wby1hY3RpdmUtb3ZlcmxheS9wby1hY3RpdmUtb3ZlcmxheS5zZXJ2aWNlJztcbmltcG9ydCB7IFBvTGFuZ3VhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvcG8tbGFuZ3VhZ2UvcG8tbGFuZ3VhZ2Uuc2VydmljZSc7XG5cbi8qKlxuICogQGRvY3NFeHRlbmRzIFBvTW9kYWxCYXNlQ29tcG9uZW50XG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tbW9kYWwtYmFzaWNcIiB0aXRsZT1cIlBPIE1vZGFsIEJhc2ljXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1tb2RhbC1iYXNpYy9zYW1wbGUtcG8tbW9kYWwtYmFzaWMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tbW9kYWwtYmFzaWMvc2FtcGxlLXBvLW1vZGFsLWJhc2ljLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLW1vZGFsLWxhYnNcIiB0aXRsZT1cIlBPIE1vZGFsIExhYnNcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLW1vZGFsLWxhYnMvc2FtcGxlLXBvLW1vZGFsLWxhYnMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tbW9kYWwtbGFicy9zYW1wbGUtcG8tbW9kYWwtbGFicy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1tb2RhbC1mcnVpdHMtc2FsYWRcIiB0aXRsZT1cIlBPIE1vZGFsIC0gRnJ1aXRzIFNhbGFkXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1tb2RhbC1mcnVpdHMtc2FsYWQvc2FtcGxlLXBvLW1vZGFsLWZydWl0cy1zYWxhZC5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1tb2RhbC1mcnVpdHMtc2FsYWQvc2FtcGxlLXBvLW1vZGFsLWZydWl0cy1zYWxhZC5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICovXG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3BvLW1vZGFsJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BvLW1vZGFsLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBQb01vZGFsQ29tcG9uZW50IGV4dGVuZHMgUG9Nb2RhbEJhc2VDb21wb25lbnQge1xuICBAVmlld0NoaWxkKCdtb2RhbENvbnRlbnQnLCB7IHJlYWQ6IEVsZW1lbnRSZWYgfSkgbW9kYWxDb250ZW50OiBFbGVtZW50UmVmO1xuICBAQ29udGVudENoaWxkKFBvTW9kYWxGb290ZXJDb21wb25lbnQpIG1vZGFsRm9vdGVyOiBQb01vZGFsRm9vdGVyQ29tcG9uZW50O1xuXG4gIHByaXZhdGUgZmlyc3RFbGVtZW50O1xuICBwcml2YXRlIGZvY3VzRnVuY3Rpb247XG4gIHByaXZhdGUgZm9jdXNhYmxlRWxlbWVudHMgPSAnaW5wdXQsIHNlbGVjdCwgdGV4dGFyZWEsIGJ1dHRvbjpub3QoW2Rpc2FibGVkXSksIGEnO1xuICBwcml2YXRlIGlkOiBzdHJpbmcgPSB1dWlkKCk7XG4gIHByaXZhdGUgc291cmNlRWxlbWVudDtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHBvQWN0aXZlT3ZlcmxheVNlcnZpY2U6IFBvQWN0aXZlT3ZlcmxheVNlcnZpY2UsIHBvTGFuZ3VhZ2VTZXJ2aWNlOiBQb0xhbmd1YWdlU2VydmljZSkge1xuICAgIHN1cGVyKHBvTGFuZ3VhZ2VTZXJ2aWNlKTtcbiAgfVxuXG4gIGNsb3NlKHhDbG9zZWQgPSBmYWxzZSkge1xuICAgIHRoaXMucG9BY3RpdmVPdmVybGF5U2VydmljZS5hY3RpdmVPdmVybGF5LnBvcCgpO1xuXG4gICAgc3VwZXIuY2xvc2UoeENsb3NlZCk7XG5cbiAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7XG5cbiAgICBpZiAodGhpcy5zb3VyY2VFbGVtZW50KSB7XG4gICAgICB0aGlzLnNvdXJjZUVsZW1lbnQuZm9jdXMoKTtcbiAgICB9XG4gIH1cblxuICBjbG9zZU1vZGFsT25Fc2NhcGVLZXkoZXZlbnQpIHtcbiAgICBpZiAoIXRoaXMuaGlkZUNsb3NlKSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0UHJpbWFyeUFjdGlvbkJ1dHRvblR5cGUoKSB7XG4gICAgcmV0dXJuIHRoaXMucHJpbWFyeUFjdGlvbi5kYW5nZXIgPyAnZGFuZ2VyJyA6ICdwcmltYXJ5JztcbiAgfVxuXG4gIGdldFNlY29uZGFyeUFjdGlvbkJ1dHRvblR5cGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2Vjb25kYXJ5QWN0aW9uICYmIHRoaXMuc2Vjb25kYXJ5QWN0aW9uLmRhbmdlciAmJiAhdGhpcy5wcmltYXJ5QWN0aW9uLmRhbmdlciA/ICdkYW5nZXInIDogJ2RlZmF1bHQnO1xuICB9XG5cbiAgb25DbGlja091dChldmVudCkge1xuICAgIGlmICh0aGlzLmNsaWNrT3V0ICYmICF0aGlzLm1vZGFsQ29udGVudC5uYXRpdmVFbGVtZW50LmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBvcGVuKCkge1xuICAgIHRoaXMuc291cmNlRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG4gICAgc3VwZXIub3BlbigpO1xuICAgIHRoaXMuaGFuZGxlRm9jdXMoKTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlRm9jdXMoKTogYW55IHtcbiAgICB0aGlzLnBvQWN0aXZlT3ZlcmxheVNlcnZpY2UuYWN0aXZlT3ZlcmxheS5wdXNoKHRoaXMuaWQpO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBpZiAodGhpcy5tb2RhbENvbnRlbnQpIHtcbiAgICAgICAgdGhpcy5pbml0Rm9jdXMoKTtcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLmZvY3VzRnVuY3Rpb24sIHRydWUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0Rm9jdXMoKSB7XG4gICAgdGhpcy5mb2N1c0Z1bmN0aW9uID0gKGV2ZW50OiBhbnkpID0+IHtcbiAgICAgIGNvbnN0IG1vZGFsRWxlbWVudCA9IHRoaXMubW9kYWxDb250ZW50Lm5hdGl2ZUVsZW1lbnQ7XG5cbiAgICAgIGlmIChcbiAgICAgICAgIW1vZGFsRWxlbWVudC5jb250YWlucyhldmVudC50YXJnZXQpICYmXG4gICAgICAgIHRoaXMucG9BY3RpdmVPdmVybGF5U2VydmljZS5hY3RpdmVPdmVybGF5W3RoaXMucG9BY3RpdmVPdmVybGF5U2VydmljZS5hY3RpdmVPdmVybGF5Lmxlbmd0aCAtIDFdID09PSB0aGlzLmlkXG4gICAgICApIHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMuZmlyc3RFbGVtZW50LmZvY3VzKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMuc2V0Rmlyc3RFbGVtZW50KCk7XG5cbiAgICBpZiAodGhpcy5oaWRlQ2xvc2UpIHtcbiAgICAgIHRoaXMuZmlyc3RFbGVtZW50LmZvY3VzKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGZpcnN0RmllbGRFbGVtZW50ID1cbiAgICAgICAgdGhpcy5tb2RhbENvbnRlbnQubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuZm9jdXNhYmxlRWxlbWVudHMpWzFdIHx8IHRoaXMubW9kYWxDb250ZW50Lm5hdGl2ZUVsZW1lbnQ7XG4gICAgICBmaXJzdEZpZWxkRWxlbWVudC5mb2N1cygpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLmZvY3VzRnVuY3Rpb24sIHRydWUpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRGaXJzdEVsZW1lbnQoKSB7XG4gICAgdGhpcy5maXJzdEVsZW1lbnQgPVxuICAgICAgdGhpcy5tb2RhbENvbnRlbnQubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuZm9jdXNhYmxlRWxlbWVudHMpIHx8IHRoaXMubW9kYWxDb250ZW50Lm5hdGl2ZUVsZW1lbnQ7XG4gIH1cbn1cbiIsIjxkaXYgKm5nSWY9XCIhaXNIaWRkZW5cIiBjbGFzcz1cInBvLW1vZGFsXCIgdGFiaW5kZXg9XCIwXCIgKGtleWRvd24uZXNjKT1cImNsb3NlTW9kYWxPbkVzY2FwZUtleSgkZXZlbnQpXCI+XG4gIDxkaXYgY2xhc3M9XCJwby1tb2RhbC1vdmVybGF5XCI+XG4gICAgPGRpdiBjbGFzcz1cInBvLW1vZGFsLWNvbnRhaW5lciBwby1wYi0yIHBvLXB0LTJcIiAobW91c2Vkb3duKT1cIm9uQ2xpY2tPdXQoJGV2ZW50KVwiPlxuICAgICAgPGRpdiBjbGFzcz1cInBvLW1vZGFsLXZlcnRpY2FsLWFsaWduXCI+XG4gICAgICAgIDxkaXYgI21vZGFsQ29udGVudCBjbGFzcz1cInBvLW1vZGFsLWNvbnRlbnQgcG8tbW9kYWwte3sgc2l6ZSB9fVwiIHRhYmluZGV4PVwiLTFcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwicG8tbW9kYWwtaGVhZGVyXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwicG8tbW9kYWwtdGl0bGUgcG8tdGV4dC1lbGxpcHNpc1wiPlxuICAgICAgICAgICAgICB7eyB0aXRsZSB9fVxuICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgIDxhICpuZ0lmPVwiIWhpZGVDbG9zZVwiIGNsYXNzPVwicG8tbW9kYWwtaGVhZGVyLWNsb3NlLWJ1dHRvblwiIHRhYmluZGV4PVwiMFwiIChjbGljayk9XCJjbG9zZSh0cnVlKVwiPlxuICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInBvLWljb24gcG8taWNvbi1jbG9zZVwiPjwvc3Bhbj5cbiAgICAgICAgICAgIDwvYT5cbiAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJwby1tb2RhbC1ib2R5XCI+XG4gICAgICAgICAgICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG4gICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwibW9kYWxGb290ZXI7IGVsc2UgZGVmYXVsdE1vZGFsRm9vdGVyVGVtcGxhdGVcIj5cbiAgICAgICAgICAgIDxuZy1jb250ZW50IHNlbGVjdD1cInBvLW1vZGFsLWZvb3RlclwiPjwvbmctY29udGVudD5cbiAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cblxuICAgICAgICAgIDxuZy10ZW1wbGF0ZSAjZGVmYXVsdE1vZGFsRm9vdGVyVGVtcGxhdGU+XG4gICAgICAgICAgICA8cG8tbW9kYWwtZm9vdGVyPlxuICAgICAgICAgICAgICA8cG8tYnV0dG9uXG4gICAgICAgICAgICAgICAgKm5nSWY9XCJzZWNvbmRhcnlBY3Rpb25cIlxuICAgICAgICAgICAgICAgIFtwLWRpc2FibGVkXT1cInNlY29uZGFyeUFjdGlvbi5kaXNhYmxlZFwiXG4gICAgICAgICAgICAgICAgW3AtbGFiZWxdPVwic2Vjb25kYXJ5QWN0aW9uLmxhYmVsXCJcbiAgICAgICAgICAgICAgICBbcC1sb2FkaW5nXT1cInNlY29uZGFyeUFjdGlvbi5sb2FkaW5nXCJcbiAgICAgICAgICAgICAgICBbcC10eXBlXT1cImdldFNlY29uZGFyeUFjdGlvbkJ1dHRvblR5cGUoKVwiXG4gICAgICAgICAgICAgICAgKHAtY2xpY2spPVwic2Vjb25kYXJ5QWN0aW9uLmFjdGlvbigpXCJcbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8L3BvLWJ1dHRvbj5cblxuICAgICAgICAgICAgICA8cG8tYnV0dG9uXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJwby1idXR0b24tbW9kYWwtZmlyc3QtYWN0aW9uXCJcbiAgICAgICAgICAgICAgICBbcC1kaXNhYmxlZF09XCJwcmltYXJ5QWN0aW9uLmRpc2FibGVkXCJcbiAgICAgICAgICAgICAgICBbcC1sYWJlbF09XCJwcmltYXJ5QWN0aW9uLmxhYmVsXCJcbiAgICAgICAgICAgICAgICBbcC1sb2FkaW5nXT1cInByaW1hcnlBY3Rpb24ubG9hZGluZ1wiXG4gICAgICAgICAgICAgICAgW3AtdHlwZV09XCJnZXRQcmltYXJ5QWN0aW9uQnV0dG9uVHlwZSgpXCJcbiAgICAgICAgICAgICAgICAocC1jbGljayk9XCJwcmltYXJ5QWN0aW9uLmFjdGlvbigpXCJcbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8L3BvLWJ1dHRvbj5cbiAgICAgICAgICAgIDwvcG8tbW9kYWwtZm9vdGVyPlxuICAgICAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuPC9kaXY+XG4iXX0=